# Introduction: Databases and RDBMS

**Database:** A collection of data (could be SQL or non-SQL).

**SQL Database**: A databased structured in tables (and by extension
columns, rows, fields, etc.).

**SQL**: A standardized language for interacting with a **SQL
database**.

**Relational Database**: A SQL database connected/linked to one or more
independent SQL database(s).

**DBMS (DataBase Management System)**: A *software* that provides an
easy way to write SQL in a SQL database, i.e. that provides an easy way
to interact with a database.

**RDBMS (Relational DataBase Management System)**: A piece of *software*
that provides an easy way to write SQL in a relational database i.e.
that provides an easy way to interact with a relational database.

**Short tutorial**:
<https://www.youtube.com/playlist?list=PLi01XoE8jYojRqM4qGBF1U90Ee1Ecb5tt>

**MySQL basics:** https://youtu.be/Cz3WcZLRaWc

<img src="./media/image1.png" style="width:6.5in;height:2.90069in" />

**Database management system**

<img src="./media/image2.png" style="width:6.5in;height:2.45208in" />

<img src="./media/image3.png" style="width:6.5in;height:1.59167in" />

<img src="./media/image4.png" style="width:6.5in;height:2.87361in" />

<img src="./media/image5.png" style="width:6.5in;height:4.08056in" />

<img src="./media/image6.png" style="width:6.5in;height:3.58333in" />

<img src="./media/image7.png" style="width:6.5in;height:3.23264in"
alt="Text Description automatically generated" />

<img src="./media/image8.png" style="width:6.5in;height:1.93889in" />

<img src="./media/image9.png" style="width:6.5in;height:2.49653in" />

## Terminology

<img src="./media/image10.png" style="width:6.5in;height:3.13681in" />
<img src="./media/image11.png" style="width:6.5in;height:3.38681in" />
<img src="./media/image12.png" style="width:6.5in;height:3.10347in" />

<img src="./media/image13.png" style="width:6.5in;height:1.91667in" />

<img src="./media/image14.png" style="width:6.5in;height:3.12917in" />

<img src="./media/image15.png" style="width:6.5in;height:2.89444in"
alt="Graphical user interface, text Description automatically generated" />

## Why SQL?

<img src="./media/image16.png"
style="width:5.79217in;height:5.08377in" />

<img src="./media/image17.png"
style="width:5.65882in;height:4.76708in" />

<img src="./media/image18.png"
style="width:5.10878in;height:5.05044in" />

<img src="./media/image19.png" style="width:6.5in;height:3.71181in" />

## Intro on Databases 

<img src="./media/image20.png" style="width:6.5in;height:3.15139in" />

<img src="./media/image21.png" style="width:6.5in;height:4.46458in" />

<img src="./media/image22.png" style="width:6.5in;height:3.48472in" />
<img src="./media/image23.png" style="width:6.5in;height:3.21319in" />
<img src="./media/image24.png" style="width:6.5in;height:2.30278in" />

## SQL Theory

<img src="./media/image25.png"
style="width:5.99219in;height:3.23361in" />

<img src="./media/image26.png" style="width:5.48636in;height:4.5491in"
alt="Text Description automatically generated" />

### DDL (Data Definition Language)

<img src="./media/image27.png" style="width:6.5in;height:2.37153in" />

<img src="./media/image28.png"
style="width:6.15887in;height:2.67335in" />

<img src="./media/image29.png"
style="width:6.33388in;height:1.31678in" />

### DML (Data Manipulation Language)

<img src="./media/image30.png" style="width:6.5in;height:0.97431in" />

<img src="./media/image31.png"
style="width:6.05886in;height:2.17519in" />

### DCL (Data Control Language)

<img src="./media/image32.png" style="width:6.5in;height:1.54792in" />

#### GRANT

<img src="./media/image33.png" style="width:6.5in;height:2.84028in" />
<img src="./media/image34.png" style="width:6.5in;height:0.63194in" />

<img src="./media/image35.png"
style="width:4.66707in;height:1.38345in" />

#### REVOKE

<img src="./media/image36.png" style="width:6.5in;height:2.48958in" />

<img src="./media/image37.png"
style="width:5.62549in;height:1.40012in" />

### TCL (Transaction Control Language)

<img src="./media/image38.png" style="width:6.5in;height:2.34444in" />
<img src="./media/image39.png"
style="width:4.61707in;height:1.50013in" />

<img src="./media/image40.png" style="width:6.5in;height:2.08056in" />
<img src="./media/image41.png"
style="width:4.84209in;height:1.78349in" />
<img src="./media/image42.png" style="width:6.5in;height:3.37014in" />

**Overview**

<img src="./media/image43.png" style="width:6.5in;height:3.99583in" />

## Database Theory

<img src="./media/image44.png" style="width:6.5in;height:3.08125in" />

### Database terminology

<img src="./media/image45.png"
style="width:5.45047in;height:1.58347in" />
<img src="./media/image46.png" style="width:6.5in;height:3.59167in" />
<img src="./media/image47.png" style="width:6.5in;height:3.44861in" />
<img src="./media/image48.png" style="width:6.5in;height:1.49792in" />
<img src="./media/image49.png" style="width:6.5in;height:1.75208in" />

<img src="./media/image50.png" style="width:6.5in;height:3.94583in" />

### Data model types

<img src="./media/image51.png" style="width:6.5in;height:3.19375in" />

<img src="./media/image52.png" style="width:6.5in;height:3.23611in" />

In this video, you will learn to describe what is meant by structured
data, semi-structured data, and unstructured data. So structured data.
Structured data is data has been organized into a formatted repository,
typically databases, so that it's elements that can made addressable for
more effective processing in analysis. Now, that simply means that
structured data is a data repository that really has a way to organize
all the different data. So I can not only go to a specific piece of
data, but I can also search for data and the data structure, and the
repository makes it very easy for me to do that without ever having seen
it before, I can understand the data structure, the data model, that
structured data, and then I can immediately go find whatever data that I
need to. Now, structured data typically has a database query languages
such as SQL, Structured Query Language, which would allow a database
administrator or application that's connecting to database to interact
with the database. It's worth mentioning structured data contrasts with
unstructured and semi-structured data. The three can be considered to
exist on a continuum, with unstructured data being the least formatted
and structured data being the most formatted. Another way to say that
would be to say that, they exists on a continuum and structured data is
the easiest to understand and most organized, and unstructured data
would be the least organized and hardest to understand and find what
you're looking for. Semi-structured data. The difference between
structured data and unstructured data is unstructured data has not been
organized into a format that makes it easier access and process.
Structured data is data that has not been organized into a specialized
repository such as a database, but that nevertheless is associated
information such as metadata, that makes it more amenable to processing
them raw data. Structured data is basically the opposite of
unstructured. It has been reformatted and its elements organized into a
daily structure so that elements can be addressed, organized, and
accessed into various combinations to make better use of the
information. However, structured data can turn to unstructured data. If
I was to take structured data from a bunch of different databases and
throw it into a new location and all of those different pieces of
structured data from those different databases, if I don't take the time
to reformat it and organize it into a data structure so that I can
understand what all of the different databases were doing, and the
different commonalities such as customers, clients, products, etcetera,
then it becomes much harder for me to understand what data is in the
database and to look for commonalities and really understand the data.
Let's move on. Unstructured data is information in many different forms
that doesn't hew to conventional data models and thus typically isn't a
good fit for mainstream relational databases. One of the most common
types of unstructured data is simply text. Unstructured text is
generated and collected in a wide range of forms including Word
documents, email messages, text messages, PowerPoints, survey responses,
transcripts, call center interactions, post from blogs, social media
sites, on and on. Other types of unstructured data include images, audio
and video files. Even though all of those different types of data are
very different, they would all be classified as unstructured data.

<img src="./media/image53.png" style="width:6.5in;height:3.20833in"
alt="Text Description automatically generated" />

### Structured Data

<img src="./media/image54.png" style="width:6.5in;height:2.39722in" />

<img src="./media/image55.png" style="width:6.5in;height:2.29028in" />

<img src="./media/image56.png" style="width:6.5in;height:3.43125in" />

<img src="./media/image57.png" style="width:6.5in;height:3.16944in" />

## Working with Goorm IDE:

- **Enter mysql shell**: mysql-ctl cli

- **Exit mysql shell**: exit or ctrl + c

- **Run SQL file**:

  - <img src="./media/image58.png"
    style="width:2.50022in;height:0.30003in" />

  - <img src="./media/image59.png"
    style="width:2.19186in;height:0.79174in" />

## PostgresQL Deets

**Pg4admin pass**: /^pgadmin$/gi

# General and Advanced SQL

## CRUD and general SQL

### Creating Databases and Tables

**Commands**

- SHOW…

  - DATABASES

  - TABLES

- SHOW COLUMNS FROM \<tname\>

- CREATE

- DROP…

  - DATABASE \<dbname\>

  - TABLE \<tname\>

  - 

- USE

- SELECT \<dbname\> ()

  - SELECT doesn’t USE, but merely returns what is being
    used/referenced.

  - 

**Note**: Use two hyphens to comment out (--)

#### Databases

<img src="./media/image60.png" style="width:6.5in;height:2.54167in" />

**SCHEMA** and **DATABASE** are used interchangeably:

<img src="./media/image61.png"
style="width:3.58364in;height:0.96675in" />

<img src="./media/image62.png"
style="width:4.09202in;height:2.49188in" />

<img src="./media/image63.png"
style="width:5.25045in;height:2.65023in" />

To find database currently being used run **SELECT database()**;

<img src="./media/image64.png"
style="width:4.2087in;height:2.34187in" />

#### Tables

Note: SHOW TABLES command can only be used if you are using a database
(**USE** \<dbname\>).

<img src="./media/image65.png"
style="width:5.60049in;height:2.50855in" />

<img src="./media/image66.png"
style="width:5.3338in;height:2.51689in" />

<img src="./media/image67.png"
style="width:4.48372in;height:2.14185in" />

<img src="./media/image68.png"
style="width:3.18361in;height:2.24186in" />

<img src="./media/image69.png"
style="width:5.34213in;height:3.35029in" />

##### ALTER TABLE

<img src="./media/image70.png" style="width:6.5in;height:0.66042in" />

<img src="./media/image71.png"
style="width:4.76708in;height:2.30853in" /><img src="./media/image72.png" style="width:6.5in;height:1.56458in" /><img src="./media/image73.png"
style="width:6.40889in;height:4.54206in" />

<img src="./media/image74.png" style="width:6.5in;height:0.71875in" />

<img src="./media/image75.png"
style="width:2.70857in;height:0.62505in" />

###### CHANGE: Redefining an entire column

<img src="./media/image76.png"
style="width:6.00885in;height:0.61672in" />

##### Data Types

<img src="./media/image77.png" style="width:6.5in;height:3.64236in" />

<img src="./media/image78.png" style="width:6.5in;height:3.64583in" />
<img src="./media/image79.png" style="width:6.5in;height:3.39375in" />

<img src="./media/image80.png" style="width:6.5in;height:3.61042in" />

<img src="./media/image81.png" style="width:6.5in;height:3.62639in" />

<img src="./media/image82.png" style="width:6.5in;height:3.81667in" />

###### **UNSIGNED**

**UNSIGNED**: A constraint that only allows for nonnegative values.

<img src="./media/image83.png" style="width:6.5in;height:3.44792in" />

<img src="./media/image84.png"
style="width:5.11711in;height:1.95017in" />

<img src="./media/image85.png"
style="width:5.30046in;height:2.17519in" />

<img src="./media/image86.png" style="width:6.5in;height:2.47153in" />

**<u>Example (Create and Delete a table)</u>**

<img src="./media/image87.png"
style="width:2.15019in;height:2.11685in" />

#### SQL objects

Tables, databases are both considered SQL objects – which can be
accessed with the dot notation.

<img src="./media/image88.png" style="width:6.5in;height:2.26597in" />

#### Key points: What am I working with?

**Lingo:**

- Records: Rows

- Attributes: Columns

- Entities: Tables

- Fields: Cells (where row + column intersect)

**<u>Databases</u>**

- **Show available databases**

  - **SHOW** databases;

- **Use a database**

  - **USE** \<db_name\>**;**

- **Find which db is currently being used (if any)**

  - **SELECT** database();

- **Delete/drop a database**

  - **DROP DATABASE** \<db_name\>;

**<u>Tables</u>**

- **Show available tables**

  - **SHOW TABLES;**

- **Show table structure (describe)**

  - **DESC** \<table_name\>;

  - **DESCRIBE \<table\>**

  - **SQL Server Syntax…**

    - **exec sp_columns MyTable**

- **Show table columns**

  - **SHOW COLUMNS FROM** \<table_name\>;

- **Show entire table**

  - **SELECT \* FROM** \<table_name\>;

- **Delete/drop a database**

  - **DROP TABLE** \<table_name\>;

- **Edit a table**

  - **ALTER TABLE** \<table_name\>;

### Inserting Data & SQL Constraints

#### Single/Multiple insert

Each record being inserted is wrapped in parenthesis – even if there are
multiple columns/attributes for each record being inserted into a table.

<img src="./media/image89.png" style="width:6.5in;height:0.88264in" />

<img src="./media/image90.png"
style="width:3.95034in;height:2.09185in" />

<img src="./media/image91.png" style="width:6.5in;height:3.73889in" />

**Gather data from a table:**

<img src="./media/image92.png"
style="width:1.85849in;height:0.32503in" />

<img src="./media/image93.png"
style="width:3.80866in;height:1.81682in" />

<img src="./media/image94.png"
style="width:4.45872in;height:4.27537in" />

**Notes**:

- You don’t need to specify any columns you are inserting into – without
  defining which columns you are inserting into SQL will expect values
  for all columns.

- You don’t need to specify columns in the same order as they are
  written in the table itself.

- In whichever order you do define columns you wish to insert into, the
  values must be written in the same order.

##### Insert into a new table from an already existing one

<img src="./media/image95.png" style="width:6.5in;height:1.94861in" />
<img src="./media/image96.png"
style="width:2.92525in;height:1.2001in" />
<img src="./media/image97.png"
style="width:2.59189in;height:1.81682in" />

#### Warnings

<img src="./media/image98.png"
style="width:4.37538in;height:1.9335in" />

#### Constraints

<img src="./media/image99.png" style="width:6.5in;height:2.14722in" />

<img src="./media/image100.png" style="width:6.5in;height:2.81111in" />

#### Not Null

<img src="./media/image101.png"
style="width:4.71708in;height:5.65882in" />

#### Default values

<img src="./media/image102.png"
style="width:4.61707in;height:5.7755in" />

<img src="./media/image103.png" style="width:6.5in;height:3.24514in" />

#### Primary Key

<img src="./media/image104.png" style="width:6.5in;height:2.68403in" />

<img src="./media/image105.png" style="width:6.5in;height:3.00833in" /><img src="./media/image106.png"
style="width:6.35888in;height:1.46679in" />

Allows you to define which column will serve as the unique identifier
for each record.

<img src="./media/image107.png"
style="width:4.98377in;height:4.70874in" />

Can place primary key on same line (next example)

**Example**

<img src="./media/image108.png" style="width:6.5in;height:1.7088in" />

#### Auto Increment

Only works on a(n)… PRIMARY KEY, INDEX, UNIQUE key

<img src="./media/image109.png"
style="width:4.55873in;height:3.78366in" />

<img src="./media/image110.png" style="width:6.5in;height:3.22778in" />

##### SQL SERVER

<img src="./media/image111.png" style="width:6.5in;height:2.61389in" />

#### UNIQUE

<img src="./media/image112.png" style="width:6.5in;height:2.10208in" /><img src="./media/image113.png" style="width:6.5in;height:2.6in" />

Although the **DISTINCT** keyword allows one to query (select)
distinct/unique values, the **UNIQUE** keyword is a constraint used to
define the data being inserted into a table. It says that only a
distinct/unique value can be inserted into the relevant column.

<img src="./media/image114.png"
style="width:3.23361in;height:0.25836in" />

<img src="./media/image115.png" style="width:6.5in;height:2.73125in" />

**Dropping an UNIQUE constraint**

Since unique keys act like an index if it needs to be dropped it needs
to be dropped as an INDEX.

<img src="./media/image116.png"
style="width:4.14203in;height:0.99175in" />

#### Complete example

<img src="./media/image117.png"
style="width:5.21712in;height:5.60049in" />

### CRUD commands

*Create, read, update, delete.*

#### Create

*See INSERT*

#### Table structure (columns)

**General**

EXEC sp_columns TestTable

**Detailed**

SELECT \* FROM information_schema.columns WHERE table_name = 'TestTable'
ORDER BY ordinal_position

#### Read (SELECT)

<img src="./media/image118.png"
style="width:5.34213in;height:3.792in" />

##### WHERE clause

Note: the WHERE caluse always goes BEFORE the GROUP BY clause – so
grouping can be done based on the WHERE constraint.

<img src="./media/image119.png"
style="width:4.09202in;height:2.22519in" />

##### HAVING Clause

Though the **WHERE** clause goes before the **GROUP BY** clause, the
**HAVING** clause can come after the **GROUP BY** clause thus further
refining our selection.

*“The HAVING clause was added to SQL because the WHERE keyword could not
be used with aggregate functions.“*

<img src="./media/image120.png"
style="width:3.31695in;height:2.65856in" />

<img src="./media/image121.png" style="width:6.5in;height:3.43819in" /><img src="./media/image122.png" style="width:6.5in;height:0.82014in" />

<img src="./media/image123.png" style="width:6.5in;height:2.775in" /><img src="./media/image124.png" style="width:6.5in;height:2.97778in" />

##### WHERE vs HAVING

**Simply**: Basically, whenever you want to group by an aggregate
function you have to use **HAVING** instead – and place it right after
the **GROUP BY** if you already have one. **HAVING** *is* the **WHERE**
clause applied to grouped records.

<img src="./media/image125.png" style="width:6.5in;height:1.31458in" />

**Example:**

<img src="./media/image126.png" style="width:6.5in;height:0.77917in" />

<img src="./media/image127.png"
style="width:3.98368in;height:1.61681in" />

##### Aliases: AS command

**Syntax**

- You can use quotes to add spaces

- MySQL – not case-sensitive

  - Because of this, letters are all equal to other opposing-case
    counterpart.

- You can refer to columns by their aliases instead of to the code that
  the column is made up of.

<img src="./media/image128.png"
style="width:5.08377in;height:1.73348in" />

**Note**: You can use a number instead of a column name in your ORDER BY
clause. This will refer to the **nth**-numbered column to which you are
selecting.

<img src="./media/image129.png" style="width:6.5in;height:0.78264in" />

It is common practice to use an alias combined with dot notation –
especially when working with joins.

<img src="./media/image130.png" style="width:6.5in;height:2.01875in" />

**Note**: It is also very common to define your aliases in your **FROM**
clause.

<img src="./media/image131.png" style="width:6.5in;height:1.53542in" />

<img src="./media/image132.png" style="width:6.5in;height:1.10764in" />

#### Update (UPDATE)

Note: To update, three commands are common: **WHERE**, **UPDATE**, and
**SET**.

**Rule of thumb**: Its good practice to SELECT the data you wish to
update before actually updating this data – just to make sure where are
updating the right data first.

**Formula**: UPDATE \<table\> SET \<column\> = ‘some value’ WHERE
\<**columnA**\> = ‘some value’;

Note: The value of \<**columnA**\> can be a unique value (like a primary
key) – in which case only one record (row) will be updated, or a
non-unique value – in which case multiple records (rows) will be
updated.

<img src="./media/image133.png"
style="width:5.55882in;height:2.42521in" />

**Updating multiple fields**

Use the **SET** command on more than on column, by adding a comma and
adding in the next SET value.

<img src="./media/image134.png"
style="width:6.90912in;height:0.5954in" />

<img src="./media/image135.png" style="width:6.5in;height:0.92917in" />

<img src="./media/image136.png"
style="width:3.44197in;height:1.85016in" />

#### Delete (DELETE)

Although similar to SELECT, one does not need to specify the columns
being referenced because DELETE will remove that entire record (all
columns in that row) corresponding to any single condition being met.

**Note**: The AUTO_INCREMENT ids of the remaining rows will not change
after one record has been deleted.

**Note**: DELETE removes entries/records, it does not remove a table
itself for example (even if using **DELETE \* FROM** \<table_name\>),
this is what the DROP method is used for.

<img src="./media/image137.png"
style="width:3.51697in;height:2.3002in" />

<img src="./media/image138.png" style="width:6.5in;height:2.26319in" />

<img src="./media/image139.png" style="width:6.5in;height:0.88819in" />

#### Complete example

<img src="./media/image140.png"
style="width:4.9421in;height:5.96718in" />

<img src="./media/image141.png"
style="width:2.76691in;height:0.57505in" />

**Note on DELTE vs TRUNCATE:** Delete and truncate both commands can be
used to delete data of the table.

Delete is a DML command whereas truncate is DDL command. Truncate can be
used to delete the entire data of the table without maintaining the
integrity of the table. On the other hand , delete statement can be used
for deleting the specific data. With delete command we can’t bypass the
integrity enforcing mechanisms.

<img src="./media/image142.png" style="width:6.5in;height:3.25694in" />

DROP vs TRUNCATE vs DELETE

<img src="./media/image143.png" style="width:6.5in;height:1.56528in" />

<img src="./media/image144.png"
style="width:5.99219in;height:0.68339in" /><img src="./media/image145.png" style="width:6.5in;height:0.95139in" /><img src="./media/image146.png" style="width:6.5in;height:4.28542in" /><img src="./media/image147.png" style="width:6.5in;height:1.76042in" />

#### CRUD QUIZ

<img src="./media/image148.png" style="width:6.5in;height:2.87986in" />

<img src="./media/image149.png" style="width:6.5in;height:4.29375in" />
<img src="./media/image150.png" style="width:6.5in;height:3.02569in" />

<img src="./media/image151.png" style="width:6.5in;height:2.48194in" />

<img src="./media/image152.png" style="width:6.5in;height:3.39306in" />

<img src="./media/image153.png" style="width:6.5in;height:3.24236in" />

<img src="./media/image154.png" style="width:6.5in;height:4.69097in" />
<img src="./media/image155.png" style="width:6.5in;height:3.66806in" />

<img src="./media/image156.png" style="width:6.5in;height:4.17292in" />

<img src="./media/image157.png" style="width:6.5in;height:4.39444in" />

<img src="./media/image158.png" style="width:6.5in;height:1.88056in" />

### The World Of String Functions

#### CONCAT & CONCAT_WS

*Concatenate & concatenate with separator*

<img src="./media/image159.png"
style="width:4.09202in;height:3.88367in" />

<img src="./media/image160.png"
style="width:4.71708in;height:2.16685in" />

#### GROUP CONCAT

Handy for making IN clauses

**SQL Server** variation is called “Aggregate string”:

SELECT STRING_AGG(D.id,',')AS RESULT

FROM (some query) D

#### SUBSTRING/SUBSTR 

Note: MySql is not zero-based. Negative numbers reverse the direction.

Two number, starting index and ending index. If no ending index is not
specified – it will continue until the end of the string.

<img src="./media/image161.png"
style="width:4.70041in;height:3.55396in" />

**String functions can be combined**

<img src="./media/image162.png"
style="width:3.18361in;height:2.47521in" />

#### REPLACE

Note: This is case-sensitive

Note: This is non-destructive.

<img src="./media/image163.png"
style="width:3.94201in;height:4.00868in" />

<img src="./media/image164.png"
style="width:4.98377in;height:2.21686in" />

#### REVERSE

<img src="./media/image165.png"
style="width:4.59206in;height:1.75849in" />

#### CHARLENGTH

Gets number of characters.

<img src="./media/image166.png"
style="width:4.55039in;height:0.55005in" />

#### UPPER/LOWER

Changes a string’s case.

<img src="./media/image167.png"
style="width:4.69207in;height:1.69181in" />

**Note about order of string functions**

<img src="./media/image168.png"
style="width:5.05877in;height:4.81708in" />

**Putting it all together (example)**

*Table*

<img src="./media/image169.png"
style="width:5.66716in;height:1.70848in" />

*SQL*

<img src="./media/image170.png"
style="width:4.50039in;height:1.04176in" />

*Result*

<img src="./media/image171.png"
style="width:6.43389in;height:1.5918in" />

### Querying II - Refining Our Selections

#### DISTINCT

Comes right after SELECT, and selects distinct instances/records of the
subsequent reference(s) (column(s)).

<img src="./media/image172.png"
style="width:4.85875in;height:1.69181in" />

#### ORDER BY

**Note**: Defaults to sort by ascending order – but this can be changed
(DESC/ASC).

**Note**: Comes at the end of a SELECT statement.

**Note**: You don’t have to SELECT the column by which you are ordering
by.

**Note**: You can use a number instead of a column name in your ORDER BY
clause. This will refer to the **nth**-numbered column to which you are
selecting.

<img src="./media/image129.png" style="width:6.5in;height:0.78264in" />

**Note**: You can sort by more than one column. The first column will be
the initial sort, The second column will only sort if and only if there
are conflicts in the first column. I.e. only if there are identical
values in two records of the first column, these records will be sorted
by the values in the second column. This can be extended for any number
of columns.

Simply put, “**sort by first column, then (if necessary) sort by second
column”**.

<img src="./media/image173.png" style="width:6.5in;height:0.62847in" />

<img src="./media/image174.png"
style="width:2.33354in;height:0.79174in" />

**Code**

<img src="./media/image175.png"
style="width:5.07544in;height:4.33371in" />

**Note:** It is common practice to pair **ORDER BY** clauses with
aliases.

<img src="./media/image176.png"
style="width:5.0171in;height:1.8835in" />

With multiple columns/expressions

<img src="./media/image177.png" style="width:6.5in;height:0.74931in" />

<img src="./media/image178.png" style="width:6.5in;height:0.80625in"
alt="Graphical user interface, text, application Description automatically generated" />

Combined with **HAVING**

<img src="./media/image179.png"
style="width:4.73374in;height:3.35862in" />

#### LIMIT

**Note**: Goes at the end – usually after the ORDER BY clause.

**Note**: Limit can take two values (separated by a comma) which will
indicate the starting and ending point (this is zero-based). If you want
to select up until the end, set some large ending value to select
everything up until that value.

<img src="./media/image180.png"
style="width:3.82533in;height:5.51714in" />

#### LIKE

***Pattern matching***

WHERE alone finds exact matches (or matches using logical operators)
whereas WHEN combined with LIKE can find *similar* matches. **Matching
value must be placed in quotes.**

**Note**: LIKE commands is case-insensitive by default.

<img src="./media/image181.png"
style="width:4.85875in;height:1.50846in" />

##### PostgreSQL: ILIKE

In PostregSQL ILIKE is case-insensitive

<img src="./media/image182.png"
style="width:5.4088in;height:0.75006in" />

#### Wildcards

- **%** - Roughly means “anything”

  - Used as a “ending/beginning with anything” wildcard when placed near
    non-wildcard characters. Can also apply to nothing as in the absence
    of a value in this place.

- \_\_ - (Underscore) used as a “x number of wildcard characters”. Where
  the number of wildcard character is defined by the number of
  underscores.

<img src="./media/image183.png"
style="width:5.09211in;height:2.17519in" />

<img src="./media/image184.png" style="width:6.5in;height:2.69028in" /><img src="./media/image185.png" style="width:6.5in;height:2.40764in" />

<img src="./media/image186.png" style="width:6.5in;height:2.30833in" />

#### Regexp (MySQL)

Works exactly where **LIKE** does.

<img src="./media/image187.png" style="width:6.5in;height:0.62361in" />

Popular regexs

<img src="./media/image188.png" style="width:6.5in;height:2.82847in" />

### The Magic of Aggregate Functions

<img src="./media/image189.png" style="width:6.5in;height:2.03681in" />

<img src="./media/image190.png" style="width:6.5in;height:0.96204in" />

<img src="./media/image191.png" style="width:6.5in;height:3.25764in" /><img src="./media/image192.png" style="width:6.5in;height:2.96667in" />

RLIKE is an alternative with an easier syntax:

<img src="./media/image193.png"
style="width:4.91735in;height:2.14613in" />

Returns ‘1’ or ‘0’ for true or false.

**<u>KEY POINT!</u>**

**Aggregate functions act on every record of the relevant column**. SUM
will sum all values of a given column, MAX/MIN will find the MAX/MIN
value in a given column, COUNT will count the number of records in a
given column, GROUP BY will group records together by a given column,
AVG, etc.

#### COUNT

*Counts the number of records*

Note: Commonly combined with DISTINCT to count number of distinct
records.

<img src="./media/image194.png"
style="width:4.29204in;height:2.23353in" />

<img src="./media/image195.png" style="width:6.5in;height:2.82361in" />

#### COUNT(DISTINCT)

<img src="./media/image196.png" style="width:6.5in;height:0.95556in" />

**Note**: The count function always directly precedes the column you
wish to reference. Consider this example:

<img src="./media/image197.png"
style="width:2.90859in;height:0.91675in" />

Parenthesis are optional as well

<img src="./media/image198.png" style="width:6.5in;height:1.91389in" />

#### GROUP BY

<img src="./media/image199.png" style="width:6.5in;height:2.06944in" />

Consolidates records into “**super records**” containing multiple
individual records based on their **GROUP BY** value.

Syntactically it comes after the WHERE clause and before the ORDER BY
clause.

<img src="./media/image200.png" style="width:6.5in;height:2.11944in" />

<img src="./media/image201.png" style="width:6.5in;height:1.57407in" /><img src="./media/image202.png" style="width:6.5in;height:4.20347in" />

<img src="./media/image203.png" style="width:6.5in;height:3.57361in" />

<img src="./media/image204.png"
style="width:6.35888in;height:3.02526in" />

<img src="./media/image205.png" style="width:6.5in;height:3.02708in" />

<img src="./media/image206.png" style="width:6.5in;height:4.2375in"
alt="Diagram Description automatically generated" />

##### Troubleshooting

###### Order of query statements

<img src="./media/image207.png"
style="width:3.40863in;height:3.19194in" />

*Rule of thumb*

<img src="./media/image208.png" style="width:6.5in;height:1.04653in" />

<img src="./media/image209.png"
style="width:3.64198in;height:1.60847in" />

*Grouping with multiple attributes/columns selected.*

From:
<https://stackoverflow.com/questions/13999817/reason-for-column-is-invalid-in-the-select-list-because-it-is-not-contained-in-e>

<img src="./media/image210.png" style="width:6.5in;height:5.43125in" />
<img src="./media/image211.png"
style="width:3.68365in;height:2.78358in" />

#### MIN/MAX

<img src="./media/image212.png"
style="width:5.96718in;height:2.24186in" />

Note: Cannot be used directly after SELECT commands to include
corresponding columns.

<img src="./media/image213.png"
style="width:3.54197in;height:2.55856in" />

#### GROUP BY + MIN/MAX

<img src="./media/image214.png"
style="width:6.02552in;height:2.36687in" />

<img src="./media/image215.png" style="width:6.5in;height:3.05694in" />

<img src="./media/image216.png"
style="width:4.2587in;height:3.41696in" />

#### SUM

Similar to MIN/MAX but it will sum up all values inside a GROUP BY
query.

<img src="./media/image217.png"
style="width:3.00026in;height:3.31695in" />

<img src="./media/image218.png" style="width:6.5in;height:3.50556in" />

AVG

Average function

<img src="./media/image219.png"
style="width:4.48372in;height:2.7419in" />

**<u>Challenge:</u>**

<img src="./media/image220.png" style="width:6.5in;height:3.98681in" />

#### NULLIF

<img src="./media/image221.png" style="width:6.5in;height:2.84653in" />

#### IFNULL

*Sql Server:* **ISNULL**

<img src="./media/image222.png" style="width:6.5in;height:1.31736in" />

**IFNULL()** is a function in SQL that takes 2 arguments: (i) the value
to check for a null value (ii) the value which will replace the first
argument if first argument returns true.

<img src="./media/image223.png"
style="width:5.61715in;height:4.17536in" />

#### COALESCE

*Standard SQL as far as I know*

<img src="./media/image224.png" style="width:6.5in;height:1.78681in" />

<img src="./media/image225.png" style="width:6.5in;height:2.93403in" />

<img src="./media/image226.png" style="width:6.5in;height:4.05347in" />

<img src="./media/image227.png" style="width:6.5in;height:1.78958in" /><img src="./media/image228.png" style="width:6.5in;height:0.87431in" />

**Parameter 1**: Working argument. If null, the value of the next
non-null argument will be used.

**Parameter 2+:** Other columns to set as the value for Parameter 1 if
parameter 1 is null.

**Parameter last**: Hard-coded value to output for parameter 1 if are
values in every preceding argument in the coalescing function is null.

<img src="./media/image229.png" style="width:6.5in;height:2.58889in" /><img src="./media/image230.png" style="width:6.5in;height:2.69583in" /><img src="./media/image231.png" style="width:6.5in;height:1.52361in" />

Coalesce is preferred over IFNULL and can even display a new temporary
column (usually for testing) if only one parameter is passed in.

<img src="./media/image232.png"
style="width:5.28379in;height:3.65865in" />

#### Subqueries

Subqueries are queries placed inside a query. The subquery will return
some value that the parent query can use.

<img src="./media/image233.png" style="width:6.5in;height:1.37431in" />

**Note**: Can also use ORDER BY for many MIN/MAX cases.

<img src="./media/image234.png"
style="width:3.52531in;height:3.40863in" />

<img src="./media/image235.png" style="width:6.5in;height:2.40486in" />
<img src="./media/image236.png" style="width:6.5in;height:1.87847in" />

**Subqueries as pseudo-tables**

Subqueries can also be used after the table in the FROM caluse to act as
a secondary pseudo-table to reference:  
<img src="./media/image237.png" style="width:6.5in;height:3.19653in" />

But the subquery can’t reference data in the out (main) query

^

#### EXISTS

<img src="./media/image238.png" style="width:6.5in;height:2.91181in" />
<img src="./media/image239.png" style="width:6.5in;height:2.64722in" />
<img src="./media/image240.png" style="width:6.5in;height:3.15417in" />

Super helpful video on NOT EXISTS:
<https://www.youtube.com/watch?v=W7c0aZorbJs>

#### IF EXISTS/IF NOT EXISTS (SQL SERVER)

<https://www.sqlshack.com/overview-of-the-t-sql-if-exists-statement-in-a-sql-server-database/>

Since **IF** checks for a true value, if can also check if something
**EXISTS** or is **NULL**.

<img src="./media/image241.png"
style="width:4.35871in;height:1.52513in" />

##### MySQL variant

<img src="./media/image242.png"
style="width:5.11711in;height:3.01693in" />

#### ROLLUP

Simple – getting average column

<img src="./media/image243.png" style="width:6.5in;height:2.96875in"
alt="A screenshot of a computer Description automatically generated" />

Advanced

<img src="./media/image244.png" style="width:6.5in;height:4.50625in"
alt="Graphical user interface, table Description automatically generated" />

^ query is the same as doing…

<img src="./media/image245.png" style="width:6.5in;height:1.06875in"
alt="Text Description automatically generated with medium confidence" />

<img src="./media/image246.png" style="width:6.5in;height:3.49931in"
alt="Table Description automatically generated" />

#### Grouping sets

<https://www.youtube.com/watch?v=Tc6-X6mNv7k>

<img src="./media/image247.png" style="width:6.10448in;height:2.64597in"
alt="Text Description automatically generated" />

### Data Types: Advanced

<img src="./media/image248.png" style="width:6.5in;height:1.87014in" />
<img src="./media/image249.png" style="width:6.5in;height:1.725in" />

#### TEXT

##### CHAR and VARCHAR

**CHAR**– fixed length/size (will be padded/truncated if size not
matched).

**VARCHAR** – variable length/size

<img src="./media/image250.png" style="width:6.5in;height:1.92639in" />

<img src="./media/image251.png" style="width:6.5in;height:2.83264in" /><img src="./media/image252.png" style="width:6.5in;height:2.75486in" /><img src="./media/image253.png" style="width:6.5in;height:2.87292in" />

##### NVARCHAR vs VARCHAR

<https://www.youtube.com/watch?v=F1ueYw5ZZus>

nvarchar is like varchr but takes twice as much space because it can
store Unicode data.

##### ENUM (mysql)

Create a column that can only accept values based on certain options
declared.

<https://dev.mysql.com/doc/refman/8.0/en/enum.html#:~:text=An%20ENUM%20is%20a%20string,specification%20at%20table%20creation%20time>.

<img src="./media/image254.png" style="width:6.5in;height:2.98472in" />

For the Sql Server equivalent see

mycol VARCHAR(10) NOT NULL CHECK (mycol IN('Useful', 'Useless',
'Unknown'))

#### Numeric

<img src="./media/image255.png" style="width:6.5in;height:1.12125in" />

<img src="./media/image256.png" style="width:6.5in;height:3.10069in" />

**Signed**: Describes whether numeric data types can be expressed with a
negative value (minus sign).

<img src="./media/image257.png" style="width:6.5in;height:1.07917in" />

##### INT

Integer

##### DECIMAL

<img src="./media/image258.png" style="width:6.5in;height:1.71667in" />

<img src="./media/image259.png" style="width:6.5in;height:1.35486in" /><img src="./media/image260.png" style="width:6.5in;height:2.92014in" />

<img src="./media/image261.png" style="width:6.5in;height:3.78542in" /><img src="./media/image262.png" style="width:6.5in;height:2.71806in" />

<img src="./media/image263.png"
style="width:6.21721in;height:2.93359in" />

<img src="./media/image264.png"
style="width:6.00052in;height:3.54197in" />

##### NUMERIC

<img src="./media/image265.png" style="width:6.5in;height:4.78611in" />

##### ROUND

Similar to decimal, pass in value into first argument, pass in number of
decimal places in second argument. Leaving the decimal argument empty
will round to the nearest integer.

<img src="./media/image266.png"
style="width:5.03377in;height:0.71673in" />

##### FLOAT and DOUBLE

<img src="./media/image267.png" style="width:6.5in;height:3.64583in" />

<img src="./media/image268.png" style="width:6.5in;height:3.23542in" /><img src="./media/image269.png" style="width:6.5in;height:1.70347in" />

<img src="./media/image270.png" style="width:6.5in;height:1.09514in" />

**Simply**: Decimals are preferred because you don’t lose precision for
larger numbers.

<img src="./media/image271.png" style="width:6.5in;height:1.34514in" />

##### JSON

###### PostgreSQL

###### MySQL

<img src="./media/image272.png" style="width:5.16944in;height:9in" />

<img src="./media/image273.png"
style="width:5.54244in;height:4.37561in" />

<img src="./media/image274.png"
style="width:5.51119in;height:5.72997in" />

###### SQL Server

<img src="./media/image275.png" style="width:5.17639in;height:9in" />

<img src="./media/image276.png"
style="width:5.71955in;height:5.83415in" />

<img src="./media/image277.png"
style="width:5.61537in;height:6.11544in" />

##### DATE and TIME

**Structure**: Large to small

<img src="./media/image278.png"
style="width:4.85875in;height:2.15019in" />

<img src="./media/image279.png"
style="width:4.73374in;height:2.11685in" />

<img src="./media/image280.png" style="width:6.5in;height:1.96667in" />

<img src="./media/image281.png"
style="width:6.28388in;height:1.5918in" />

###### Date standard (ISO 8601)

Most DBMS use ISO-8610 – which has the following format:

<img src="./media/image282.png" style="width:6.5in;height:3.28889in" />

<img src="./media/image283.png" style="width:6.5in;height:2.72153in"
alt="Diagram, text, timeline Description automatically generated" />

<img src="./media/image284.png" style="width:6.5in;height:1.56042in" />

###### Date/Time functions

<img src="./media/image285.png"
style="width:3.792in;height:0.93341in" />

<img src="./media/image286.png"
style="width:6.22554in;height:4.21703in" />

###### DATE_FORMAT

**Note**: Just about every function in MySQL that has the word “date” in
it can accept a DATE_FORMAT result as an argument.

DATE_FORMAT() accepts two arguments: Date (accepts DATETIME) and format
(as referenced by a specifier). The second argument can be filled with
any string of text as well. Technically the second parameter is text,
but the date/time values are being interpolated in virtue of the
function of the ‘**%**’ symbol in this argument.

<https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_date-format>

<img src="./media/image287.png" style="width:6.5in;height:4.50278in" />

<img src="./media/image288.png" style="width:6.5in;height:2.45347in" />
<img src="./media/image289.png"
style="width:6.01719in;height:1.55847in" />

<img src="./media/image290.png"
style="width:4.77541in;height:1.14177in" />

PostregSQL and Oracle uses **TO_CHAR**

###### Date Math

####### DATEDIFF

Takes two date values, returns the difference in ***days*** (put more
recent date first).

<img src="./media/image291.png" style="width:6.5in;height:1.47847in" />.

####### DATE_ADD \[MySQL\]

Takes two arguments: (i) date/datetime (2) interval of time being added
to it.

<img src="./media/image292.png" style="width:6.5in;height:4.70625in" />

**Note**: Instead of writing out DATE_ADD function, you can just use the
plus sign (or subtract).

<img src="./media/image293.png"
style="width:6.45056in;height:0.3417in" />

Same as…

<img src="./media/image294.png"
style="width:6.48273in;height:0.34626in" />

Using arithmetic operators also allows you to chain more intervals of
time:

<img src="./media/image295.png"
style="width:6.52472in;height:0.23492in" />

####### DATEADD \[SQL SERVER\]

<https://www.w3schools.com/sql/func_sqlserver_dateadd.asp>

SELECT DATEADD(ss, \<epoch\>, '19700101');

exmple

SELECT DATEADD(ss, 1291388960, '19700101');

<img src="./media/image296.png" style="width:6.5in;height:2.65903in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

Create a table with a columns such that the default value is the current
epoch:

updatedate BIGINT DEFAULT DATEDIFF(s, '1970-01-01 00:00:00',
GETUTCDATE()),

###### Dates and Epochs

####### SQL Server

**Get <u>current</u> epoch or Unix timestamp in SQL Server**

We can use CURRENT_TIMESTAMP() function to get the current unix
timestamp.

CURRENT_TIMESTAMP()  
  
Output: 1624705077

**Convert date to epoch or unix timestamp in SQL Server**

we can convert the date time string to unix timestamp
using UNIX_TIMESTAMP() and STR_TO_DATE() function like below:

DATEDIFF(s, '1970-01-01 00:00:00', '2021-06-26 22:50:27.000')  
  
Output: 1624705077

**Convert epoch or Unix timestamp to date in SQL Server**

We can use the DATEADD() function to convert the epoch or timestamp to
readable date format.

DATEADD(ss, \<epoch\>, '19700101');

DATEADD(s, 1624705077, '1970-01-01 00:00:00')

Output: 2021-06-26 22:50:27.000

Required. The time/date interval to add. Can be one of the following
values:

- year, yyyy, yy = Year

- quarter, qq, q = Quarter

- month, mm, m = month

- dayofyear, dy, y = Day of the year

- day, dd, d = Day

- week, ww, wk = Week

- weekday, dw, w = Weekday

- hour, hh = hour

- minute, mi, n = Minute

- second, ss, s = Second

- millisecond, ms = Millisecond

####### MySQL

**<u>Get current epoch:</u>**

SELECT UNIX_TIMESTAMP(NOW());

**Two months ago:**

SELECT UNIX_TIMESTAMP(NOW()) - (60 \* 60 \* 24 \* 60);

**Get month and da num**

SELECT

FROM_UNIXTIME(unix_timestamp(NOW()),'%c'),

FROM_UNIXTIME(unix_timestamp(NOW()),'%e' )

SELECT \*,msdid_totalusage_mb/1024 AS gb,msdid_totalusage_mb/1024/1024
AS tb ,

FROM_UNIXTIME(updatedate,'%c'),

FROM_UNIXTIME(updatedate,'%e' )

FROM MemberStorageDetailsUsageHistory WHERE msdid=82740 ORDER BY
updatedate DESC;

**<u>Get beginning of current day UTC</u>**

SELECT UNIX_TIMESTAMP(CURDATE())

<img src="./media/image297.png"
style="width:4.65625in;height:0.96875in" />

**Get date string from epoch**

<https://database.guide/from_unixtime-examples-mysql/>

SELECT FROM_UNIXTIME(946562400, '%W, %D %M %Y') AS Result;

| Friday, 31st December 1999 |

SELECT FROM_UNIXTIME(946609199, '%h:%i %p, %D %M %Y') AS Result;

| 12:59 PM, 31st December 1999 |

<img src="./media/image298.png"
style="width:6.64793in;height:5.17985in" />

<img src="./media/image299.png" style="width:6.5in;height:2.78333in" />

###### TIMESTAMPS

**Note:** Actually its own datatype in MySQL

DATETIME and TIMESTAMP do the same thing insofar as they both store both
the date and the time. **The key difference is the range they cover.**

**<u>Ranges</u>**

**DATETIME:** Ranges from year 1000 A.D. – 9999 A.D

**TIMESTAMP:** Ranges from Jan 1<sup>st</sup> 1970 – Jan 19<sup>th</sup>
2038 *(like many other programming languages that use time).*

<u>Note on storage</u>: Also, timestamp uses half the space of DATETIME.

DATETIME is preferred unless dealing with a smaller (contemporary) range
of time.

**Get <u>current</u> epoch or Unix timestamp in SQL Server**

We can use CURRENT_TIMESTAMP() function to get the current unix
timestamp.

CURRENT_TIMESTAMP()  
  
Output: 1624705077

**<u>Useful use-case for timestamps</u>**

Combining TIMESTAMP with a [default](#default-values) value is
especially useful.

<img src="./media/image300.png"
style="width:4.51706in;height:1.92517in" />

<img src="./media/image301.png"
style="width:5.00877in;height:1.37512in" />

You can also combine this with the ON UPDATE command

<img src="./media/image302.png" style="width:6.5in;height:0.82431in" />

**Note**: CURRENT_TIMESTAMP can be replace interchangeably with
**NOW()** function.

<img src="./media/image303.png"
style="width:5.29213in;height:0.30003in" />

Code:

<img src="./media/image304.png"
style="width:4.9421in;height:5.51714in" />

**<u>Summary & code</u>**

<img src="./media/image305.png"
style="width:6.02552in;height:5.36713in" />

<img src="./media/image306.png"
style="width:6.17554in;height:2.05851in" />

**<u>In PostregreSQL (timestamptz)</u>**

<img src="./media/image307.png" style="width:6.5in;height:1.96319in" />

#### BLOB

<img src="./media/image308.png" style="width:6.5in;height:3.06667in" />

### The Power of Logical Operators

**Note**: Returned Boolean value are expressed as ‘**1’** (*true*) and
**‘0’** (*false*) in SQL.

**Note**: Since variables are not stored in SQL, the equal sign (=)
serves as both an **assignment operator** as well as a **comparison
operator**.

<img src="./media/image309.png" style="width:6.5in;height:3.88125in" />

The WHERE clause can be combined with **AND**, **OR**, and **NOT**
operators.

**NOTE**: AND can be replaced with ‘**&&**’ and OR can be substituted
with ‘**||**’.

#### operators generally

<img src="./media/image310.png" style="width:6.5in;height:2.63958in" /><img src="./media/image311.png" style="width:6.5in;height:2.12778in" /><img src="./media/image312.png" style="width:6.5in;height:2.57153in" />

#### NOT

*Note: ‘Not equal’ should be expressed !=*

<img src="./media/image313.png"
style="width:3.88367in;height:1.78349in" />

#### BETWEEN

**Note**: Always paired with ‘**AND’** written out.

<img src="./media/image314.png" style="width:6.5in;height:1.54306in" />

#### NOT BETWEEN

<img src="./media/image315.png" style="width:6.5in;height:1.51319in" />

#### CAST

<img src="./media/image316.png" style="width:6.5in;height:2.59722in" />

For comparing dates (especially of different data types) its best
practice to CAST your dates as the same data type (DATETIME for example)
before comparing these values.

You can achieve this using **CAST(… AS…)**

<img src="./media/image317.png"
style="width:4.07535in;height:1.33345in" />

<img src="./media/image318.png" style="width:6.5in;height:2.69306in" />

Data analysts usually need to convert data from one format to another to
complete an analysis. But what if you are using SQL rather than a
spreadsheet? Just like spreadsheets, SQL uses standard rules to convert
one type of data to another. If you are wondering why data
transformation is an important skill to have as a data analyst, think of
it like being a driver who is able to change a flat tire. Being able to
convert data to the right format speeds you along in your analysis. You
don’t have to wait for someone else to convert the data for you. 

<img src="./media/image319.png" style="width:6.5in;height:0.81875in"
alt="A series of icons: a magnifying glass, an open book, a calendar with a pencil, a signpost, and thumbs up sign" />

In this reading, you will go over the conversions that can be done using
the **CAST** function. There are also more specialized functions like
**COERCION** to work with big numbers, and **UNIX_DATE** to work with
dates. **UNIX_DATE** returns the number of days that have passed since
January 1, 1970 and is used to compare and work with dates across
multiple time zones. You will likely use **CAST** most often.  

##### Common conversions 

The following table summarizes some of the more common conversions made
with the **CAST** function. Refer to [Conversion Rules in Standard
SQL](https://cloud.google.com/bigquery/docs/reference/standard-sql/conversion_rules)
for a full list of functions and associated rules. 

<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr>
<th><strong>Starting with</strong></th>
<th><strong>CAST function can convert to:</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Numeric (number)</td>
<td>- Integer - Numeric (number) - Big number - Floating integer -
String</td>
</tr>
<tr>
<td>String</td>
<td>- Boolean - Integer - Numeric (number) - Big number - Floating
integer - String - Bytes - Date - Date time - Time - Timestamp</td>
</tr>
<tr>
<td>Date</td>
<td>- String - Date - Date time - Timestamp</td>
</tr>
</tbody>
</table>

##### The CAST function (syntax and examples)

**CAST** is an American National Standards Institute (ANSI) function
used in lots of programming languages, including BigQuery. This section
provides the BigQuery syntax and examples of converting the data types
in the first column of the previous table. The syntax for the CAST
function is as follows:

<img src="./media/image320.png" style="width:6.5in;height:0.81458in"
alt="Screenshot of CAST function" />CAST (expression AS typename)

Where **expression** is the data to be converted and **typename** is the
data type to be returned.

###### **Converting a number to a string**

The following **CAST** statement returns a string from a numeric
identified by the variable MyCount in the table called MyTable. 

<img src="./media/image321.png" style="width:6.5in;height:0.73125in"
alt="Screenshot of CAST statement " />SELECT CAST (MyCount AS STRING)
FROM MyTable

In the above SQL statement, the following occurs:

- **SELECT** indicates that you will be selecting data from a table

- **CAST** indicates that you will be converting the data you select to
  a different data type

- **AS** comes before and identifies the data type which you are casting
  to

- **STRING** indicates that you are converting the data to a string

- **FROM** indicates which table you are selecting the data from

###### **Converting a string to a number**

The following **CAST** statement returns an integer from a string
identified by the variable MyVarcharCol in the table called MyTable. (An
integer is any whole number.)

<img src="./media/image322.png" style="width:6.5in;height:0.76181in"
alt="Screenshot of CAST statement" />SELECT CAST(MyVarcharCol AS INT)
FROM MyTable

In the above SQL statement, the following occurs:

- **SELECT** indicates that you will be selecting data from a table

- **CAST** indicates that you will be converting the data you select to
  a different data type

- **AS** comes before and identifies the data type which you are casting
  to

- **INT** indicates that you are converting the data to an integer

- **FROM** indicates which table you are selecting the data from

###### **Converting a date to a string**

The following **CAST** statement returns a string from a date identified
by the variable MyDate in the table called MyTable. 

<img src="./media/image323.png" style="width:6.5in;height:0.67014in"
alt="SELECT CAST (MyDate AS STRING) FROM MyTable" />

In the above SQL statement, the following occurs:

- **SELECT** indicates that you will be selecting data from a table

- **CAST** indicates that you will be converting the data you select to
  a different data type

- **AS** comes before and identifies the data type which you are casting
  to

- **STRING** indicates that you are converting the data to a string

- **FROM** indicates which table you are selecting the data from

###### **Converting a date to a datetime**

Datetime values have the format of YYYY-MM-DD hh: mm: ss format, so date
and time are retained together. The following **CAST** statement returns
a datetime value from a date. 

<img src="./media/image324.png" style="width:6.5in;height:0.69236in"
alt="Screenshot of CAST statement" />

In the above SQL statement, the following occurs:

- **SELECT** indicates that you will be selecting data from a table

- **CAST** indicates that you will be converting the data you select to
  a different data type

- **AS** comes before and identifies the data type which you are casting
  to

- **DATETIME** indicates that you are converting the data to a datetime
  value

- **FROM** indicates which table you are selecting the data from

##### The SAFE_CAST function

Using the **CAST** function in a query that fails returns an error in
BigQuery. To avoid errors in the event of a failed query, use the
**SAFE_CAST** function instead. The **SAFE_CAST** function returns a
value of Null instead of an error when a query fails. 

The syntax for **SAFE_CAST** is the same as for **CAST**. Simply
substitute the function directly in your queries. The following
**SAFE_CAST** statement returns a string from a date.

<img src="./media/image325.png" style="width:6.5in;height:0.60417in"
alt="Screenshot of CAST statement" />SELECT SAFE_CAST (MyDate AS STRING)
FROM MyTable

##### More information

Browse these resources for more information about data conversion using
other SQL dialects (instead of BigQuery):

- [CAST and
  CONVERT](https://docs.microsoft.com/en-us/sql/t-sql/functions/cast-and-convert-transact-sql?view=sql-server-ver15):
  SQL Server reference documentation

- [MySQL CAST Functions and
  Operators](https://dev.mysql.com/doc/refman/8.0/en/cast-functions.html):
  MySQL reference documentation

- [How to: SQL Type
  Casting](https://www.blendo.co/blog/how-to-sql-type-casting/): Blog
  about type casting that has links to other SQL short guides

#### AGE

*May be PostgresSQL only*

<img src="./media/image326.png" style="width:6.5in;height:2.53403in" />

Useful for retrieving age of anything

<img src="./media/image327.png"
style="width:3.56698in;height:3.12527in" />

#### EXTRACT

<img src="./media/image328.png" style="width:6.5in;height:2.12778in" /><img src="./media/image329.png" style="width:6.5in;height:3.30833in" /><img src="./media/image330.png" style="width:6.5in;height:1.49167in" /><img src="./media/image331.png"
style="width:2.99193in;height:1.23344in" /><img src="./media/image332.png"
style="width:4.22537in;height:1.41679in" />

#### IN

**Says**: *“only return cases equal to at least one of these values…”*

Basically, it adds an **OR** operator to each passed in value for long
**OR** queries.

<img src="./media/image333.png" style="width:6.5in;height:0.95625in" />

#### NOT IN

**Says**: *“only return cases not equal to any of these values…”*

Basically, it adds an **AND** **NOT** operator to each passed in value
for long **AND NOT** queries.

**Instead of….**

<img src="./media/image334.png" style="width:6.5in;height:3.14653in" />

**We can use…**

<img src="./media/image335.png" style="width:6.5in;height:1.31181in" />

#### % (modulo)

An example, using modulo to get all odd instances (instances not evenly
divisible by 2 without any remainder).

<img src="./media/image336.png" style="width:6.5in;height:2.16458in" />

#### IS NULL/ IS NOT NULL

It is not possible to test for NULL values with comparison operators,
such as =, \<, or \<\>.

Use the **IS NULL** keyword when you are looking for values.

<img src="./media/image337.png"
style="width:3.26695in;height:4.21703in" />

#### CASE Statements

**On Select Statement**

<img src="./media/image338.png" style="width:5.4105in;height:3.4174in"
alt="Text Description automatically generated" />

<img src="./media/image339.png" style="width:5.87687in;height:4.6971in"
alt="Text Description automatically generated" />

**On Where statement**

<img src="./media/image340.png" style="width:6.5in;height:2.18125in"
alt="Text Description automatically generated" />

Similar to switch statements in JS.

Cases are added as an attribute/column.

**<u>Keywords:</u>**

**CASE:** holds the record value returned by the **THEN/ELSE**
statements.

**WHEN**: Holds an expression which will evaluate the current value
against some condition.

**THEN**: Returns a value to **CASE** if a given condition (WHEN
expression) is satisfied.

**ELSE**: Returns a default value to **CASE** if no previous conditions
are met.

**Note**: You can add multiple WHEN/THEN expressions to check against
and they are not comma-separated.

<img src="./media/image341.png"
style="width:4.35038in;height:1.50013in" />

<img src="./media/image342.png" style="width:6.5in;height:1.33194in" />

<img src="./media/image343.png" style="width:6.5in;height:2.95208in" />

**Another example:**

<img src="./media/image344.png" style="width:6.5in;height:1.66875in" />

<img src="./media/image345.png" style="width:6.5in;height:3.25in" />

**Sample code:**

<img src="./media/image346.png" style="width:6.5in;height:5.32986in" />

**Note:** You can use case statements inside an aggregate function

<img src="./media/image347.png"
style="width:3.792in;height:2.19186in" />

### Joins, Relational DBs, & Schemas: An intro

<img src="./media/image348.png" style="width:6.5in;height:3.23889in"
alt="Text Description automatically generated" />

<img src="./media/image349.png" style="width:6.5in;height:2.86389in"
alt="Text Description automatically generated with medium confidence" />
<img src="./media/image350.png" style="width:6.5in;height:1.85556in"
alt="Graphical user interface, text, website Description automatically generated" />
<img src="./media/image351.png" style="width:6.5in;height:1.20903in"
alt="A picture containing website Description automatically generated" />

**One-to-many:**

*One book – many reviews (One -\> Many)*

*Many reviews for one book (Many -\> One)*

<img src="./media/image352.png" style="width:6.5in;height:3.7375in"
alt="Graphical user interface, application Description automatically generated" />

**Many-to-many relationships**

*Many books each by many authors (Many -\> Many)*

*Many authors have many books (Many -\> Many)*

<img src="./media/image353.png" style="width:6.5in;height:3.72153in"
alt="Graphical user interface, application Description automatically generated" />

#### Data Model & example

**Example of a Data model**: Each box represents a table

<img src="./media/image354.png" style="width:6.42556in;height:4.82542in"
alt="Timeline Description automatically generated" />

<img src="./media/image355.png" style="width:6.5in;height:3.11944in"
alt="Text Description automatically generated" />

Data model is built from app not other way around. When modeling data,
it’s important to ask “what’s the most important table?”.

**<u>Example data model of a playlist:</u>**

Note: Each box represents a table. Main table (box) is determined by
unique rows.

<img src="./media/image356.png" style="width:6.5in;height:3.36875in"
alt="Graphical user interface, diagram Description automatically generated with medium confidence" />

<img src="./media/image357.png" style="width:6.5in;height:3.57361in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image358.png" style="width:6.5in;height:3.36944in"
alt="Diagram Description automatically generated" />

<img src="./media/image359.png" style="width:6.5in;height:3.33125in"
alt="Diagram Description automatically generated" />

Note: We should create highly contingent tables last and **a se** tables
first.<img src="./media/image360.png" style="width:6.5in;height:2.78125in"
alt="Text Description automatically generated" />

<img src="./media/image361.png" style="width:6.5in;height:3.33333in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image362.png" style="width:6.5in;height:3.52014in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

##### A schema example

<img src="./media/image363.png" style="width:6.5in;height:3.28472in"
alt="Diagram Description automatically generated" />

<img src="./media/image364.png" style="width:6.5in;height:3.95486in"
alt="Diagram Description automatically generated" />

##### Quiz

<img src="./media/image365.png" style="width:6.5in;height:2.78194in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image366.png" style="width:6.5in;height:4.07917in"
alt="Graphical user interface, text, application, email Description automatically generated" />
<img src="./media/image367.png" style="width:6.5in;height:5.1375in"
alt="Graphical user interface, application Description automatically generated" />

<img src="./media/image368.png" style="width:6.5in;height:2.35in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image369.png" style="width:6.5in;height:2.81736in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image370.png" style="width:6.5in;height:5.15417in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image371.png" style="width:6.35055in;height:3.4253in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image372.png" style="width:6.5in;height:5.56944in"
alt="Graphical user interface, text, application, email Description automatically generated" />

<img src="./media/image373.png" style="width:6.5in;height:2.35in"
alt="Text Description automatically generated with medium confidence" />

<img src="./media/image374.png" style="width:6.5in;height:3.89444in"
alt="Graphical user interface, application, Teams Description automatically generated" />

<img src="./media/image375.png" style="width:6.5in;height:0.92847in"
alt="Graphical user interface, text, application, email Description automatically generated" />

#### One To Many

##### What are benefits of foreign keys?

<https://learnsql.com/blog/why-use-foreign-key-in-sql/>

<img src="./media/image376.png" style="width:6.5in;height:5.11458in" />

<img src="./media/image377.png" style="width:6.5in;height:5.64097in"
alt="A screenshot of a computer Description automatically generated" />

<img src="./media/image378.png" style="width:6.5in;height:6.69236in"
alt="A screenshot of a computer Description automatically generated" />

##### One-to-Many: Primary & Foreign Keys

<img src="./media/image379.png" style="width:6.5in;height:3.40625in"
alt="Application Description automatically generated with medium confidence" />

<img src="./media/image380.png" style="width:6.5in;height:3.46875in"
alt="Graphical user interface, text, application Description automatically generated" />

Logical keys are some human-recognizable string used to reference a
record (think a band name or album title where we would use that to find
the data, but the record itself itself should be identified by the
primary key as that won’t change.)

<img src="./media/image381.png" style="width:6.5in;height:3.52639in"
alt="Text Description automatically generated" />

<img src="./media/image382.png" style="width:6.5in;height:3.15556in"
alt="A picture containing text Description automatically generated" />

<img src="./media/image383.png" style="width:6.5in;height:3.30139in"
alt="Graphical user interface, application Description automatically generated" />

<img src="./media/image384.png" style="width:6.5in;height:3.56806in"
alt="Graphical user interface Description automatically generated" />

<img src="./media/image385.png" style="width:6.5in;height:3.025in"
alt="Graphical user interface, text, application Description automatically generated" />

**Example**: Customer & orders (one cust/multiple orders)

<img src="./media/image386.png" style="width:6.5in;height:2.58194in"
alt="Text Description automatically generated" />

<img src="./media/image387.png" style="width:6.5in;height:2.54375in"
alt="Graphical user interface Description automatically generated with medium confidence" />

**PRIMARY KEY**

<img src="./media/image388.png" style="width:6.5in;height:3.77361in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

**FOREIGN KEY**

<img src="./media/image389.png" style="width:6.5in;height:3.63125in"
alt="A picture containing diagram Description automatically generated" />

**Convention:** Name foreign keys after the table being referenced
followed by the column being referenced.

Example:

**customer_id** is a foreign key which references the **customer** table
and the **id** column, hence, **customer_id**.

<img src="./media/image390.png" style="width:5.71716in;height:1.45013in"
alt="Graphical user interface, text, application Description automatically generated" />

**Sample code:**

<img src="./media/image391.png" style="width:5.35046in;height:5.41714in"
alt="Table Description automatically generated with medium confidence" />

<img src="./media/image392.png" style="width:5.28379in;height:1.66681in"
alt="Graphical user interface, text, application Description automatically generated" />

**Note on deleting records**: Records that contain a PRIMARY KEY cannot
be deleted if the PRIMARY KEY of that record is being used as a FOREIGN
KEY of another table. Likewise, tables cannot be deleted if they contain
records which serve as a reference for the foreign keys in other tables.

These tables (*contingent tables*) which use a foreign key are thus
contingent on their reference (*reference table*). Because of this we
can’t delete the reference table itself nor any records from the
reference table that have primary keys being used as a foreign key
reference by some other table because this would throw an error (since
some external tables rely on this table’s data).

One way to get around this problem would be to delete the contingent
record (the records containing the foreign key) then we can delete the
references table (or any records since they are no longer being
referenced by anything). But there’s a better solution.

##### ON DELETE…CASCADE

**FOREIGN KEY** constraints are often paired with the **ON DELETE…
CASCADE** constraint as well as the **ON UPDATE …CASCADE** constraint.

What we need to do to solve this, is add a constraint to FOREIGN KEY of
the contingent table. Such a constraint would say that for any record
referencing an independent table, if the reference table is deleted then
any associated records in the contingent table must also be deleted. For
this we used the ON DELETE… CASCADE keywords. This says “on deletion of
our reference, that deletion will cascade to this record as well”.

<img src="./media/image393.png" style="width:6.5in;height:0.99375in"
alt="A picture containing text Description automatically generated" />

<img src="./media/image394.png" style="width:4.41705in;height:1.94184in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image395.png" style="width:5.21712in;height:5.58382in"
alt="A picture containing text Description automatically generated" />

<img src="./media/image396.png" style="width:6.5in;height:3.59167in"
alt="Calendar Description automatically generated" />

**Cascade can work on update as well:**

<img src="./media/image397.png" style="width:6.08386in;height:0.95008in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

**This commands says:** “If there are any changes made to the parent
table (delete or update) cascade these changes down to the child tables.

<img src="./media/image398.png" style="width:6.5in;height:3.35208in"
alt="Text Description automatically generated" />

##### IF Statement

<https://www.mysqltutorial.org/mysql-if-statement/>

##### IF Function

**Note**: IF ***functions*** in SQL are written as a ternary statement
using three arguments and which return a value from the IF function.

<img src="./media/image399.png"
style="width:4.34413in;height:0.21877in" />

<https://www.mysqltutorial.org/mysql-if-function.aspx>

<img src="./media/image400.png" style="width:6.5in;height:4.49583in"
alt="Graphical user interface, table Description automatically generated with medium confidence" />

##### JOINS

<https://youtu.be/9yeOJ0ZMUYw>

<img src="./media/image401.png" style="width:6.5in;height:3.57639in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

<img src="./media/image402.png" style="width:6.5in;height:3.56875in"
alt="Diagram Description automatically generated" />

**Note**: PostresSQL supports all four types of joins whereas MySQL and
SQLlite do not support **FULL JOINs**.

<img src="./media/image403.png" style="width:6.5in;height:4.59861in"
alt="Diagram Description automatically generated" />

<https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/>

<img src="./media/image404.png" style="width:6.5in;height:3.42083in"
alt="Table Description automatically generated" />
<img src="./media/image405.png" style="width:6.5in;height:3.20069in"
alt="Table Description automatically generated" />
<img src="./media/image406.png" style="width:6.5in;height:3.19861in"
alt="Table Description automatically generated" />

###### Joins: Basics

- Joins are cases where two or more tables are joined to retrieve
  interrelated data.

- Joins usually link a **foreign key** from one table with a **primary
  key** of another to return a set of related data.

- The **ON** keyword designates where the two tables should connect – on
  what criteria/condition.

- **Dot notation**: When referencing columns in a JOIN query…

  - Columns with unique names can be referenced with or without dot
    notation

    - With dot notation:

      - <img src="./media/image407.png"
        style="width:2.68357in;height:0.17735in" />

    - Without dot notation

      - <img src="./media/image408.png"
        style="width:1.97517in;height:0.21875in" />

    - **Best practice**: It never hurts to use dot notation where
      applicable, so it’s best practice to use it anyway since it also
      improves readability.

- The JOIN keyword joins two tables, the ON keyword sets the criterion
  by which record-joining occurs. JOIN…ON can be memorized am JOIN…
  WHERE.

- **LEFT vs RIGHT join**: Both terms can be said to refer to distinct
  tables.

  - **LEFT** refers to the ***primary*/*first*** table being queried
    against. This table is the first table mentioned in a query.

    - <u>LEFT JOIN</u>: List entire LEFT (primary) table + also add any
      matching records from RIGHT (secondary) table.

  - **RIGHT** refers to the ***secondary/second*** table – the one being
    joined to the primary table. This table is the second table
    mentioned in a query.

    - <u>RIGHT JOIN</u>: List entire Right (secondary) table + also add
      any matching records from LEFT (primary) table.

<img src="./media/image409.png" style="width:6.5in;height:2.81528in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image410.png" style="width:6.5in;height:3.37847in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

<img src="./media/image411.png" style="width:6.5in;height:2.91042in"
alt="Graphical user interface Description automatically generated with low confidence" />

Note how records from the primary table are duplicated to accommodate
for every possible combination with its joined table.

<img src="./media/image412.png" style="width:6.5in;height:3.65278in"
alt="A picture containing graphical user interface Description automatically generated" />

###### Cross Join

<img src="./media/image413.png" style="width:6.5in;height:3.65069in"
alt="Graphical user interface, text, application, timeline Description automatically generated" />

###### Inner join

**Joins every possible record from both A and B where the join condition
is met.**

<img src="./media/image414.png" style="width:6.5in;height:4.22917in"
alt="Diagram Description automatically generated" />

**Note**: When using inner join, the order doesn’t change what data is
being retrieved (since you are matching both tables equally) but it does
affected what the data is presented.

<img src="./media/image415.png" style="width:5.92551in;height:3.77533in"
alt="Table Description automatically generated" />

**Helpful animation**:
<https://dataschool.com/how-to-teach-people-sql/inner-join-animated/>

<img src="./media/image416.gif" style="width:6.5in;height:3.6417in"
alt="gif of not adding unmatched rows" />

Another thing to consider is that SQL will join the rows every time
there is a match. So if your data in the columns you are joining on are
not unique you will get duplicate data in the final table.

Non Unique data in Second table:

<img src="./media/image417.png" style="width:6.29221in;height:4.02535in"
alt="Table Description automatically generated" />
<img src="./media/image418.png" style="width:6.5in;height:3.55069in"
alt="Diagram Description automatically generated" />
<img src="./media/image419.png" style="width:6.5in;height:4.01042in"
alt="Diagram, venn diagram Description automatically generated" />
<img src="./media/image420.png" style="width:6.5in;height:2.80347in"
alt="Diagram Description automatically generated with low confidence" />

**Sample code**:

<img src="./media/image421.png" style="width:4.66707in;height:4.84209in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image422.png" style="width:4.30871in;height:2.90859in"
alt="Graphical user interface, text Description automatically generated" />

###### Left Join

*Also called LEFT OUTER join*

**Helpful animation**:
<https://dataschool.com/how-to-teach-people-sql/left-right-join-animated/>

For each record in the left table, an associated record from the right
table will be joined to that record (if any exists). Simply: shows every
record from left table – joins records from the right table where
applicable.

<img src="./media/image423.png" style="width:6.5in;height:0.43333in" />

<img src="./media/image424.png" style="width:6.5in;height:3.96667in"
alt="Table Description automatically generated" />

###### Right Join

*Also called RIGHT OUTER join*

<img src="./media/image425.png" style="width:5.65882in;height:4.05869in"
alt="Diagram Description automatically generated" />

Right join is same as left join if you switch tables being joined.

<img src="./media/image426.png" style="width:3.95034in;height:2.72524in"
alt="Text Description automatically generated" />

<img src="./media/image427.png" style="width:6.5in;height:3.19375in"
alt="Diagram, venn diagram Description automatically generated" />

###### Old Syntax

<img src="./media/image428.png" style="width:6.5in;height:3.64167in"
alt="Diagram Description automatically generated" />
<img src="./media/image429.png" style="width:6.5in;height:2.77986in"
alt="Graphical user interface, text, application, email Description automatically generated" />
<img src="./media/image430.png" style="width:6.5in;height:2.0125in"
alt="Text Description automatically generated" />

###### Join + Where

<img src="./media/image431.png" style="width:6.5in;height:1.94097in"
alt="A picture containing text Description automatically generated" />
<img src="./media/image432.png" style="width:5.76717in;height:1.14177in"
alt="Graphical user interface Description automatically generated with low confidence" />
<img src="./media/image433.png" style="width:5.27546in;height:3.55864in"
alt="Graphical user interface, text, application Description automatically generated" />

###### Full outer Join

The FULL OUTER JOIN keyword returns all records when there is a match in
left (table1) or right (table2) table records.

***Note**: Not supported by MySQL and SQL lite*

<img src="./media/image434.png" style="width:6.5in;height:2.40069in"
alt="Table Description automatically generated" /><img src="./media/image435.png" style="width:6.5in;height:2.73392in"
alt="Diagram, venn diagram Description automatically generated" /><img src="./media/image436.png" style="width:6.5in;height:3.64792in"
alt="Table Description automatically generated" />

###### Complete example (One-to-Many)

<img src="./media/image437.png" style="width:5.24212in;height:5.64216in"
alt="Text Description automatically generated with low confidence" />

This query (below) will produce table (below)

Note: This is an **INNER JOIN** (inner is implied is left out)

<img src="./media/image438.png" style="width:6.5in;height:1.97083in"
alt="Text, letter Description automatically generated" />

This example shows all students (even if no paper/grade):

<img src="./media/image439.png" style="width:4.25037in;height:2.7419in"
alt="Text Description automatically generated with medium confidence" />

<img src="./media/image440.png" style="width:6.5in;height:2.12014in"
alt="Text Description automatically generated" />

Sdsd

<img src="./media/image441.png" style="width:3.80033in;height:1.9085in"
alt="Text Description automatically generated" />

<img src="./media/image442.png" style="width:6.5in;height:2.18333in"
alt="Text Description automatically generated" />

<img src="./media/image443.png" style="width:3.54197in;height:2.04184in"
alt="Text Description automatically generated" /><img src="./media/image444.png" style="width:5.79217in;height:3.64198in"
alt="A picture containing text Description automatically generated" />

<img src="./media/image445.png" style="width:4.26704in;height:2.55856in"
alt="Text Description automatically generated" />

<img src="./media/image446.png" style="width:6.5in;height:2.60486in"
alt="Calendar Description automatically generated" />

#### Many To Many

**Review**: One-to-many

<img src="./media/image447.png" style="width:6.5in;height:3.46667in"
alt="Graphical user interface, diagram Description automatically generated" />

<img src="./media/image448.png" style="width:6.5in;height:2.99861in"
alt="Graphical user interface Description automatically generated" />
<img src="./media/image449.png" style="width:6.5in;height:3.22847in"
alt="Diagram Description automatically generated" />

Many-to-many table relationships can share an intermeditate table which
has a one-to-many relationship to each table it is joining. This
connector table doesn’t need a primary key at all, it can just be
compoed of two foreign keys. Additionaly, if you wanted to add a unique
contrasint you can just se the constraint as the combination of the teo
fields in question.

##### A practical example

In this example we see any single course may hold data for many
different accounts and any single account may hold data for many
different courses. These ca n be joined with an intermediate table often
called a “junciton” or “connector” table.

**<u>IMPORTANT</u>**: Worth nothing that when building tables, the
intermediate table must be created LAST because it depends on the
external tables (by which it uses foreign keys to reference).

<img src="./media/image450.png" style="width:6.5in;height:3.09653in"
alt="Diagram Description automatically generated" />

<img src="./media/image451.png" style="width:6.5in;height:3.71389in"
alt="Text Description automatically generated" /><img src="./media/image452.png" style="width:6.5in;height:3.44444in"
alt="Text Description automatically generated with medium confidence" />

The primary key of the intermediate table uses a combination of the two
foreign keys to form a new unique (not null – since foreign keys
reference primary keys of other tables) value.

<img src="./media/image453.png" style="width:6.5in;height:3.58889in"
alt="Graphical user interface, application Description automatically generated" />

<img src="./media/image454.png" style="width:6.5in;height:3.54653in"
alt="Graphical user interface Description automatically generated" /><img src="./media/image455.png" style="width:6.5in;height:3.69583in"
alt="A picture containing graphical user interface Description automatically generated" /><img src="./media/image456.png" style="width:6.5in;height:3.34444in"
alt="Graphical user interface, diagram Description automatically generated" />

To query against such a many-to-many relationship, we have to…

1)  **SELECT** an attribute (column) from each table

2)  **JOIN** every table (including intermediate table)

    1.  **ON…** connect **table1** to intermediate table

    2.  **AND…** connect **table2** to intermediate table

<img src="./media/image457.png" style="width:6.5in;height:3.27083in"
alt="Text Description automatically generated" />
<img src="./media/image458.png" style="width:6.5in;height:3.17361in"
alt="Text Description automatically generated" />

##### Another example

<img src="./media/image459.png" style="width:6.5in;height:3.85417in"
alt="Diagram Description automatically generated" />

##### Tips and tricks

You don’t necessarily have to have adjacent tables in order to join.

<img src="./media/image460.png" style="width:6.5in;height:4.27222in"
alt="Diagram Description automatically generated" />

<img src="./media/image461.png" style="width:4.30037in;height:2.02518in"
alt="Graphical user interface, text, application Description automatically generated" />

##### UNIONS

**JOINS** add columns (from another table) into the working table.
**UNIONS** add rows (from another table) – thus the tables must have
same column structure & naming scheme.

<https://www.youtube.com/watch?v=JZdtgPaPP_A>

<https://www.w3schools.com/sql/sql_union.asp>

<img src="./media/image462.png" style="width:6.5in;height:4.90139in"
alt="Graphical user interface, text, application, email Description automatically generated" />

<img src="./media/image463.png" style="width:6.5in;height:1.85764in"
alt="Timeline Description automatically generated" />

Simply: UNIONS stack and Joins

<img src="./media/image464.png" style="width:6.5in;height:2.68194in"
alt="Table Description automatically generated" /><img src="./media/image465.png" style="width:6.5in;height:3.46319in"
alt="Table Description automatically generated" /><img src="./media/image466.png" style="width:6.5in;height:3.26042in"
alt="Graphical user interface Description automatically generated with low confidence" />

##### Intro: TV show app

###### A conceptual schema

<img src="./media/image467.png" style="width:6.5in;height:3.43542in"
alt="Text Description automatically generated with medium confidence" />

<img src="./media/image468.png" style="width:6.5in;height:4.15903in"
alt="Diagram Description automatically generated" />

<img src="./media/image469.png" style="width:6.5in;height:3.96181in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />

###### Create Tables

<img src="./media/image470.png" style="width:3.5003in;height:1.85849in"
alt="Text Description automatically generated" />

<img src="./media/image471.png" style="width:3.29195in;height:1.74182in"
alt="Text Description automatically generated" />

<img src="./media/image472.png" style="width:4.55039in;height:1.8835in"
alt="Text Description automatically generated" />

**<u>IMPORTANT</u>**: Worth nothing that when building tables, the
intermediate table must be created LAST because it depends on the
external tables (by which it uses foreign keys to reference).

###### Inserting data

*Inserting data into **non-intermediate** tables*

<img src="./media/image473.png" style="width:6.5in;height:3.74306in"
alt="Text, letter Description automatically generated" />

<img src="./media/image474.png" style="width:6.5in;height:2.49861in"
alt="Text Description automatically generated" />

*Inserting data into out **intermediate**
table*<img src="./media/image475.png" style="width:6.5in;height:3.27153in"
alt="A picture containing text Description automatically generated" />

###### Joining tables

To query against such a many-to-many relationship, we have to…

1)  **SELECT** an attribute (column) from each table

2)  **JOIN** every table (including intermediate table)

    1.  **ON…** connect **table1** to intermediate table

    2.  **AND…** connect **table2** to intermediate table

**IMPORTANT:** Because outer tables (non-intermediate tables) are
connected to each other through the intermediate tables, multiple outer
tables cannot be queried against directly – they can only be queried
individually and joined with the intermediate (connecting table).

***Note*** in the diagram below, **authors** and **books** are never
both queried against in the same query, they are either **(i)** queried
individually or **(ii)** queried together but ***through*** the
connecting table (i.e. one outer table + connecting table).

<img src="./media/image476.jpeg" style="width:6.5in;height:2.1624in"
alt="Many-to-many (data model) - Wikipedia" />

Likewise, in our case, the **series** and **reviewers** tables are both
outer tables connected by the **reviews** table.

##### Challenge 1

<img src="./media/image477.png" style="width:4.08369in;height:4.07535in"
alt="Table Description automatically generated" /><img src="./media/image478.png" style="width:3.20028in;height:1.25844in"
alt="Graphical user interface, text Description automatically generated" />

##### Challenge 2: Average rating

<img src="./media/image479.png" style="width:4.92543in;height:3.55864in"
alt="Table Description automatically generated" /><img src="./media/image480.png" style="width:3.55864in;height:1.83349in"
alt="Text Description automatically generated" />

##### Challenge 3: Every review by reviewer

<img src="./media/image481.png" style="width:4.29204in;height:4.97543in"
alt="Table Description automatically generated" /><img src="./media/image482.png" style="width:4.2087in;height:3.67532in"
alt="A picture containing timeline Description automatically generated" />

**Note**: notice how you can use two alternative joins because the order
doesn’t matter in an INNER JOIN when you are only choosing matching
records.

##### Challenge 4: Unreviewed series

<img src="./media/image483.png" style="width:5.23379in;height:2.20019in"
alt="Text Description automatically generated" /><img src="./media/image484.png" style="width:3.58364in;height:1.33345in"
alt="Text Description automatically generated" />

##### Challenge 5: Rating by genre

<img src="./media/image485.png" style="width:5.8005in;height:3.11694in"
alt="A picture containing calendar Description automatically generated" /><img src="./media/image486.png" style="width:4.00035in;height:1.61681in"
alt="Text Description automatically generated" />

##### Challenge 6: Analytics

<img src="./media/image487.png" style="width:6.5in;height:1.98819in"
alt="Table, calendar Description automatically generated" /><img src="./media/image488.png" style="width:4.82542in;height:5.26712in"
alt="Text Description automatically generated with medium confidence" />

##### Challenge 7: Multi-Join – (3 tables)

**Note**: For a many-to-many join/ multiple joins, we join table 1 with
intermediate table then we join table 2 with intermediate table.

<img src="./media/image489.png" style="width:5.74216in;height:3.75866in"
alt="Table Description automatically generated" />

<img src="./media/image490.png" style="width:4.30871in;height:2.10018in"
alt="Text Description automatically generated" />

#### Self-join

Technically acts just as an inner join but is preferred when joining
against the same table

<img src="./media/image491.png" style="width:6.5in;height:1.14792in"
alt="Text Description automatically generated with medium confidence" />
<img src="./media/image492.png" style="width:6.5in;height:3.84583in"
alt="Diagram Description automatically generated" />
<img src="./media/image493.png" style="width:6.5in;height:3.80556in"
alt="Chart Description automatically generated with medium confidence" />

Example:

<img src="./media/image494.png" style="width:6.5in;height:2.96042in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image495.png" style="width:6.5in;height:2.77222in"
alt="Text Description automatically generated" /><img src="./media/image496.png" style="width:6.5in;height:2.26597in"
alt="Text Description automatically generated" /><img src="./media/image497.png" style="width:4.79208in;height:2.89192in"
alt="Table Description automatically generated" /><img src="./media/image498.png" style="width:6.5in;height:2.67083in"
alt="Table Description automatically generated" /><img src="./media/image499.png" style="width:6.5in;height:1.72569in"
alt="Text Description automatically generated" /><img src="./media/image500.png" style="width:5.10044in;height:4.05869in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image501.png" style="width:6.5in;height:1.65625in"
alt="Table Description automatically generated" />

### Instagram Database Clone

#### Users Schema

<img src="./media/image502.png" style="width:3.35029in;height:1.1001in"
alt="Text, letter Description automatically generated" />

#### Photos Schema

<img src="./media/image503.png" style="width:2.79191in;height:2.90859in"
alt="A blue screen with white text Description automatically generated with low confidence" />

<img src="./media/image504.png" style="width:3.64198in;height:1.26678in"
alt="Text Description automatically generated" />

#### Comments Schema

<img src="./media/image505.png" style="width:6.5in;height:2.62431in"
alt="A screenshot of a computer Description automatically generated with low confidence" />

<img src="./media/image506.png" style="width:3.60031in;height:1.67515in"
alt="Text Description automatically generated" />

#### Likes Schema

<img src="./media/image507.png" style="width:6.5in;height:2.40139in"
alt="A screenshot of a computer Description automatically generated with low confidence" />

**Note**: Likes will not have an ID attribute/column since we won’t need
to refer to it from any other table.

**Creating only one like per user**: We will need to create a primary
key (which sets a unique constraint) and this primary key will be based
on the value of the user and the photo. Thus, there can only be one
primary key in the likes table per each user + photo combination – i.e.
one **like** per user for each photo.

<img src="./media/image508.png"
style="width:3.56698in;height:0.29169in" />

**Example**: Showing trying to insert another like of a picture by the
same person.

<img src="./media/image509.png"
style="width:6.1172in;height:0.65006in" />

<img src="./media/image510.png" style="width:3.842in;height:1.67515in"
alt="Text, letter Description automatically generated" />

#### Follows Schema

<img src="./media/image511.png" style="width:6.5in;height:2.44653in"
alt="A screenshot of a computer Description automatically generated with low confidence" />

<img src="./media/image512.png" style="width:6.5in;height:3.90417in"
alt="Table Description automatically generated" />

<img src="./media/image513.png" style="width:3.792in;height:1.5418in"
alt="Text, letter Description automatically generated" />

#### Tags Schema

<img src="./media/image514.png" style="width:6.5in;height:3.68958in"
alt="Text Description automatically generated with low confidence" />
<img src="./media/image515.png" style="width:6.5in;height:3.59583in"
alt="A screenshot of a computer Description automatically generated with medium confidence" />
**SOLUTION
3!!!**<img src="./media/image516.png" style="width:6.5in;height:3.77153in"
alt="Table Description automatically generated with medium confidence" />

<img src="./media/image517.png" style="width:3.71699in;height:2.12518in"
alt="Text, letter Description automatically generated" />

#### Complete IG Clone Schema <img src="./media/image518.png" style="width:3.94201in;height:3.80866in"
alt="Text Description automatically generated" /> <img src="./media/image519.png" style="width:4.1837in;height:5.03377in"
alt="Text Description automatically generated" />

#### Working With Lots Of Instagram Data

##### Challenges

<img src="./media/image520.png" style="width:2.68357in;height:1.28344in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image521.png" style="width:3.48364in;height:1.67515in"
alt="Text Description automatically generated" />

<img src="./media/image522.png" style="width:4.12536in;height:1.40846in"
alt="Graphical user interface, text, application Description automatically generated" /><img src="./media/image523.png"
style="width:4.6004in;height:2.60856in" />

<img src="./media/image524.png" style="width:4.17536in;height:1.27511in"
alt="Text, letter Description automatically generated" />

<img src="./media/image525.png" style="width:3.40863in;height:2.2752in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image526.png" style="width:4.75875in;height:2.50022in"
alt="Text, letter Description automatically generated" />

## Node & MySQL

### NPM Setup

1.  **Install & Import MySQL package**

<img src="./media/image527.png"
style="width:2.13352in;height:0.45004in" />

<img src="./media/image528.png"
style="width:3.16599in;height:0.22288in" />

This ‘***mysql’*** packages gives us access to special methods and
properties we can used to interact with our database. These methods
include things like ***‘createConnection’*** and ***‘query’*** as well
as properties like ***‘host’***, ***‘user’***, and ***‘database’***.

### Connecting MySQL with Node

1.  **Connect to MySQL**

The ***createConnection*** method can be called on the mysql object we
are importing into our project. This ***createConnection*** method
accepts an argument which is an object containing all of the database
connection details and credentials. This can be saved into a variable
(named ***‘connection’*** for example) which will have its own methods
that can be called on this new variable.

<img src="./media/image529.png" style="width:6.5in;height:2.65278in" />

2.  **Connect to MySQL**

The ***query*** method can be called on the ***connection*** variable.
The ***query*** method takes 2 parameters

1)  Query to run

2)  Callback function to execute once query runs

    1.  Parameter 1: Holds the error value

        1.  You can place a ***guard clause*** to check for a truthy
            ***error*** value and throw an ***error*** if there is an
            error.

    2.  Parameter 2: Holds the value of the query results

        1.  Results are returned in an array ‘wrapper’, selected
            **\[0\]** index to ‘unwrap’ result.

    3.  

<img src="./media/image530.png" style="width:6.5in;height:2.01597in" />

**Querying with Aliases**

Using SQL aliases for attributes/columns in your query allows you to
access these attributes by the alias name as a property name on the
object being returned.

<img src="./media/image531.png"
style="width:4.07535in;height:2.00851in" />

**Closing connection**

It’s a good practice to close your connection when you have executed
your query using the ***end()*** method on the ***connection***
variable.

<img src="./media/image532.png"
style="width:1.60014in;height:0.45004in" />

### Sample code

<img src="./media/image533.png"
style="width:4.08369in;height:2.36687in" />

### Outline: Node + MySQL

<img src="./media/image534.png"
style="width:5.76717in;height:5.65882in" />
<img src="./media/image535.png"
style="width:5.03377in;height:2.50855in" />

### Node & MySQL: Interacting with Database

<img src="./media/image536.png"
style="width:4.20036in;height:1.1001in" />

#### Selecting Data

<img src="./media/image537.png"
style="width:5.44214in;height:4.1837in" />

#### Inserting Data

The ***mysql*** npm package allows you to insert data using an object
literal containing the data you wish to insert. The ***keys*** of the
object will present the ***columns/attributes*** you wish to insert into
and the ***values*** of the object will represent the ***values*** you
wish to insert.

The ***query*** method itself will use three parameters instead of the
typical two. The first will still be the query to run, the last will
still be the callback, but the second argument will now be the variable
containing the object you wish to pass in place of the **‘SET ?’**
keywords:

**Three arguments**

1.  **Parameter 1**: Query to run - must use the **SET** keyword
    followed by a question mark

2.  **Parameter 2**: Object containing data to insert.

3.  **Parameter 3**: Callback

<img src="./media/image538.png" style="width:6.5in;height:0.18528in" />

<img src="./media/image538.png" style="width:6.5in;height:0.62996in" />

With this, the first argument of the ***query*** method (the query
itself), will be constructed as this behind the scenes:

<img src="./media/image538.png"
style="width:6.23134in;height:0.22234in" />

**Inserting into multiple columns**

To insert into multiple columns just add another key-value pair:

<img src="./media/image539.png" style="width:6.5in;height:0.76852in" />

This will look like a standard insert behind the scenes:

Note: image is cut off

<img src="./media/image539.png"
style="width:5.91667in;height:0.21296in" />

**Sample code**

<img src="./media/image540.png" style="width:6.5in;height:4.27917in" />

##### Inserting dates & times

The **mysql** npm package will always try to convert any date/times into
the same format as the SQL date/time format (YYYY-MM-DD HH:MI:SS)
whenever values are being inserting into a column with a date/time data
type.

##### Bulk insert

Using a nested array as the object to pass in and omit the **SET**
keyword in the query.

<img src="./media/image541.png" style="width:6.5in;height:3.16875in" /><img src="./media/image542.png"
style="width:4.51706in;height:5.24212in" />

#### Exercises

<img src="./media/image543.png"
style="width:4.60873in;height:4.6504in" /><img src="./media/image544.png"
style="width:4.39205in;height:2.12518in" />

### Building Our Web App

Run ***npm init***, install & import the express js package

<img src="./media/image545.png" style="width:6.5in;height:3.39583in" />
<img src="./media/image546.png" style="width:6.5in;height:3.40069in" />

**Listen**: This method listens for a request made from this port.

***Simply:*** *This tells the server to listen.*

**Get**: This method listens for a ***get*** request made on the file
path specified in parameter 1 and executes a callback as specified in
parameter 2.

***Simply:*** *This tells the server where to listen and what to do when
it ‘hears’ something.*

Together, the ***get*** and ***listen*** methods create a listener on a
specific ***port*** on the server and executes a function when a request
or response is made on a given ***path***.

**Note**: The ***post*** method is another variant which listens to post
requests.

**The get callback**

The ***response*** argument has a ***send*()**method inside which we can
pass information we want to send pack to the client.

<img src="./media/image547.png"
style="width:3.80033in;height:3.73366in" />

<img src="./media/image548.png"
style="width:5.85051in;height:2.73357in" />

#### Connecting Express with MySQL

<img src="./media/image549.png" style="width:6.5in;height:3.13403in" />

#### Send data to client

<img src="./media/image550.png"
style="width:4.27537in;height:1.97517in" />

#### Use EJS package

This is a JS templating package

The set() method allows you to set settings of our app. The second
argument specifies the file extension.

<img src="./media/image551.png"
style="width:6.01719in;height:0.7334in" />

**Setting a view**

Instead of using the ***send*** method on the response argument we can
use the ***render*** method to respond with the content of file located
in the ***views*** directory.

<img src="./media/image552.png"
style="width:1.5418in;height:1.02509in" />

<img src="./media/image553.png" style="width:6.5in;height:3.04375in" />

***Ejs fie***

<img src="./media/image554.png" style="width:6.5in;height:1.84583in" />

**Dynamically passing in data**

The ***render*** method can also take in a second argument which is an
object which we can use to specify the data we wish to be interpreted as
dynamic in our EJS file using key-value pairs. The ***key*** is the word
we can use to be interpreted which will in reality contain the value
contained in the ***value***.

<img src="./media/image555.png"
style="width:3.80866in;height:0.28336in" />

The EJS file will recognize dynamic data when it is wrapped in the
**\<%=**dat**%\>**,.

<img src="./media/image556.png"
style="width:2.76691in;height:0.55838in" />

Anything passed in these brackets will be interpreted as JavaScript.

<img src="./media/image557.png"
style="width:2.68357in;height:0.37503in" />

Another example:

<img src="./media/image558.png"
style="width:6.21721in;height:0.24218in" />

<img src="./media/image559.png"
style="width:3.20861in;height:0.29169in" />

<img src="./media/image560.png"
style="width:5.71716in;height:2.40021in" />

#### Connecting the form

**Body parser package**

This package will parse the form data received from the ***res***
argument in the ***app.post*** callback function.

<img src="./media/image561.png" style="width:6.5in;height:1.67615in" />

<img src="./media/image562.png" style="width:6.5in;height:1.12917in" />

<img src="./media/image563.png"
style="width:5.7255in;height:2.17519in" />

# Advanced SQL

**Great sql-server playlist**

<https://www.youtube.com/playlist?list=PL08903FB7ACA1C2FB>

## MySQL and AES Ecryption

**Create Table with Encryption:**

CREATE TABLE \`TestEncrypted\` (

\`id\` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,

\`text\` VARCHAR(256) NOT NULL,

\`text_enc\` BLOB NOT NULL

) ;

**Insert Encrypted Data:**

INSERT INTO TestEncrypted(text,text_enc) VALUES

(

'my message!',

AES_ENCRYPT("my message!","supersecretpass")

);

**Query Encrypted Data:**

SELECT

text,CONVERT(AES_DECRYPT(text_enc, "supersecretpass") USING utf8) AS
text_enc

FROM TestEncrypted

## SQL Server and TCL

### Theming

<https://thwack.solarwinds.com/groups/data-driven/b/blog/posts/making-ssms-pretty-my-dark-theme>

# **Making SSMS Pretty: My Dark Theme**

<img src="./media/image564.jpeg"
style="width:0.51875in;height:0.51875in" alt="AaronBertrand" />

[**AaronBertrand**](https://thwack.solarwinds.com/members/aaronbertrand)*[over
9 years
ago](https://thwack.solarwinds.com/groups/data-driven/b/blog/posts/making-ssms-pretty-my-dark-theme)4
minute read time*

**Updated November 26, 2019**

I've been using a dark theme in SSMS for some time now. For myself, I
find it far easier to read light on dark, if you choose the right
colors. 

Here is a code sample:

[Fullscreen](https://thwack.solarwinds.com/groups/data-driven/b/blog/posts/making-ssms-pretty-my-dark-theme)

1

2

3

4

5

6

7

8

SELECT GETDATE(), N'hello'

FROM sys.all_columns AS c

LEFT OUTER JOIN sys.all_objects AS o

ON c.\[object_id\] = o.\[object_id\]

/\* ORDER BY something \*/

ORDER BY c.name;

EXEC sys.sp_help;

And here is a screenshot of the same code in my local copy of SSMS:

<img src="./media/image565.png" style="width:6.5in;height:3.41875in"
alt="SSMS Dark Mode Screenshot" />

The only real difference, which you may have spotted, is that WP-GeSHi
treats ambiguous words like LEFT and RIGHT as if they were built-in
functions (which they are), while SSMS treats them as keywords (which
they also are).

**There are two ways to go about this:**

1\. You can set the color settings manually

2\. You can import my theme via a .vssettings file that I share below

## **Doing this the hard way**

You can do this manually, of course. Go to Tools / Options / Environment
/ Fonts and Colors. Highlight text editor and make the background dark
and the foreground light:

<img src="./media/image566.png" style="width:6.5in;height:4.34028in"
alt="Tools Option Screenshot" />

(Mine areRGB(228,228,228) for Item foreground andRGB(50,50,50) for Item
background.)

Then go down the list and change the "Item foreground" color for things
you want to change, using the Custom... button. Put a snippet of text in
a query window that has just about everything - DMVs, functions,
keywords, system procedures, comments, highlighted text, string, etc. so
you can see the effects after every change.

You'll have to play with it on your own to get the settings you like.
Here are some of the other customizations I've made (the update is that
I've chosen a slightly different pink for built-in functions, changed
SQL stored procedures to green in order to match DMVs and system tables,
and changed comments to orange):

- Comment:RGB(255,175,45)

- Keyword:RGB(127,176,228)

- Script Comment:RGB(255,175,45)

- Script keyword: CyanRGB(0,255,255)

- Script string: YellowRGB(255,255,0)

- SQL Operator:RGB(199,199,199)

- SQL Stored Procedure:RGB(128,255,128)

- SQL String: YellowRGB(255,255,0)

- SQL System Function:RGB(220,120,255)

- SQL System Table:RGB(128,255,128)

I also make size changes for text results and grid results (which
require a restart of the application to take effect), and I change grid
results from MS Sans Serif to Calibri, and text results from Courier New
to Consolas.

## **Doing this the smart way**

A while back, Doug Holland [blogged about using the VSSettings file to
share
themes](http://blogs.msdn.com/b/dohollan/archive/2012/04/20/sql-server-2012-management-studio-darker-shades-of-blue-theme.aspx).
(In fact, you may like his color scheme better than mine.)

After the one-time manual process above, it was easy to share the
.vssettings file so that I could implement the same color scheme on
other machines.

First, I need to go to Tools, Import and Export Settings, and choose
"Export selected environment settings:

<img src="./media/image567.png" style="width:6.5in;height:4.52847in"
alt="Tools Menu in SSMS Screenshot" />

<img src="./media/image568.png" style="width:6.5in;height:5.95069in"
alt="SSMS Wizard - Import and Export Screenshot" />

Then I select only the checkbox for All Settings \> Options \>
Environment \> Fonts and Colors:

<img src="./media/image569.png" style="width:6.5in;height:5.95069in"
alt="SSMS Wizard Import and Export" />

Note: I also use pretty big fonts in order to minimize the need to zoom
anything when presenting. So I've created two separate files, one
with LargeFonts in the name, and one with NormalFonts. You can download
them below and start from whichever one is more appropriate for you.

To import them, you follow the wizard in almost the same way. Go to the
same menu item, but this time choose Import selected environment
settings. You will be prompted to save your current settings (a good
idea; in the event you can't stand my colors, it will be easy to
revert):

<img src="./media/image570.png" style="width:6.5in;height:5.96597in"
alt="SSMS Import and Export Wizard - Screenshot" />

Then you will likely have to move the above files into your Documents \\
SQL Server Management Studio \\ Settings \\ SQL Server Management Studio
folder to have them show up here:

<img src="./media/image571.png" style="width:6.5in;height:5.96597in"
alt="SSMS Wizard Importing Theme" />

Then the following options should be the only ones selected, and you can
choose Finish:

<img src="./media/image572.png" style="width:6.5in;height:5.96597in"
alt="SSMS Wizard - Choosing Settings" />

Note that some settings may not take effect until you re-launch
Management Studio (grid and text result settings are still sticky even
in the most recent SQL Server 2016 version).

I keep these two files on a thumb drive and in the cloud so that, no
matter where I am, it's drop-dead simple to switch sensible coding font
sizes to making all of my code and results readable to the nosebleed
seats in a large room at a conference. I'm thinking about adding other
options to my switch files too, like returning results in a separate
tab, including the query output in the results, and other things I tend
to do only when demoing / presenting.

Note: this should work for Visual Studio as well, but I haven't tried it
(and my specific customizations won't affect most of what you do in VS
anyway). Enjoy, and let me know if you have any suggestions or what
additional customizations you have made.

[AB.DarkScheme.vssettings.zip](https://thwack.solarwinds.com/cfs-file/__key/telligent-evolution-components-attachments/01-78-00-00-00-00-68-92/AB.DarkScheme.vssettings.zip)

### SQL Server/ MS Access syntax variants

<img src="./media/image573.jpeg" style="width:6.5in;height:5.02381in"
alt="https://image.slidesharecdn.com/sqlservercheatsheet-110802190346-phpapp02/95/sql-server-cheatsheet-1-728.jpg?cb=1312312965" />

**T**-**SQL** (**Transact**-**SQL**) is a set of programming extensions
from Sybase and Microsoft that add several features to the Structured
Query Language (**SQL**), including transaction control, exception and
error handling, row processing and declared variables.

### Symmetric Key Encryption

#### General Outline

-- SETUP - USE RELEVANT DB

USE cooldatabase;

-- 1. Create master key

CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'super_pass';

-- 2. Verify mkey exists

SELECT \* FROM sys.symmetric_keys

-- 3. Create Certificate

CREATE CERTIFICATE ATestCertificate WITH SUBJECT = 'A Test Certificate';

-- 4. Verify certificate exists

SELECT \* FROM sys.certificates

-- 5. Create Symmetric Key \[Certificate-based\]

CREATE SYMMETRIC KEY supersymmetrickey

WITH ALGORITHM = AES_256

ENCRYPTION BY CERTIFICATE ATestCertificate;

GO

-- 5. Create Symmetric Key \[Password-based\]

CREATE SYMMETRIC KEY supersymmetrickeywpass

WITH ALGORITHM = AES_256

ENCRYPTION BY PASSWORD='mycoolpassword';

-- 6. Verify new Symmetric Key exists

SELECT \* FROM sys.symmetric_keys

-- 7. Save something into DB by encrypting it \[Using certificate-based
symmetric key\]

OPEN SYMMETRIC KEY supersymmetrickey

DECRYPTION BY CERTIFICATE ATestCertificate

INSERT key_testing

VALUES(

EncryptByKey(key_GUID('supersymmetrickey'), 'pleaseencryptme' )

)

CLOSE SYMMETRIC KEY supersymmetrickey

-- 7. Save something into DB by encrypting it \[Using password-based
symmetric key\]

OPEN SYMMETRIC KEY supersymmetrickeywpass

DECRYPTION BY PASSWORD='mycoolpassword'

INSERT key_testing

VALUES(

EncryptByKey(key_GUID('supersymmetrickeywpass'), 'pleaseencryptmemoar' )

)

CLOSE SYMMETRIC KEY supersymmetrickeywpass

-- 8. Decrypt an encrypted string \[Using certificate-based symmetric
key\]

(using varchar max but if you have an initial string length pre-defined
on the plaintext to be encrypted that you can use the minimum - for
example char(9))

OPEN SYMMETRIC KEY supersymmetrickey

DECRYPTION BY CERTIFICATE ATestCertificate

SELECT CONVERT(VARCHAR(MAX),DECRYPTBYKEY(encpass)) FROM key_testing
WHERE id='3'

CLOSE SYMMETRIC KEY supersymmetrickey

-- 8. Decrypt an encrypted string \[Using password-based symmetric key\]

OPEN SYMMETRIC KEY supersymmetrickeywpass

DECRYPTION BY PASSWORD='mycoolpassword'

SELECT CONVERT(VARCHAR(MAX),DECRYPTBYKEY(encpass))

FROM key_testing WHERE id='5'

CLOSE SYMMETRIC KEY supersymmetrickeywpass

#### Create Symmetric Key

##### View any certificates/checking if exists 

Keys will be saved, not under databases schema, but under Security \>
Certificates

<img src="./media/image574.png" style="width:3.3225in;height:1.8331in"
alt="A screenshot of a computer Description automatically generated" />

You can also view using  sys.certificates

SELECT \* FROM sys.certificates

<img src="./media/image575.png" style="width:6.5in;height:0.26597in" />

<img src="./media/image576.png" style="width:6.5in;height:1.07153in"
alt="A screenshot of a computer Description automatically generated" />

##### Create Certificate

<https://docs.microsoft.com/en-us/sql/t-sql/statements/create-certificate-transact-sql?view=sql-server-ver15>

<https://sqlity.net/en/2375/create-certificate/>

A certificate can only be protected by either a password or the database
master key. If a password is specified during creation, that same
password is required every time the private key needs to be accessed.

###### Using Masterkey

Masterkeys are database-specific and there can only be one per database

####### Create masterkey

<https://sqlity.net/en/2373/create-database-master-key/>

CREATE MASTER KEY ENCRYPTION BY PASSWORD = '\*\*\*\*\*\*\*\*\*\*\*\*';

View all keys…

 SELECT \* FROM sys.symmetric_keys

There will only be one master key (per database) and it will have name
“##MS_DatabaseMasterKey##”

SELECT \*FROM sys.symmetric_keys AS SK  
WHERE SK.name = '##MS_DatabaseMasterKey##';

<img src="./media/image577.jpeg" style="width:6.5in;height:3.85197in"
alt="The Database Master Key" />

####### Create Cert

The CREATE CERTIFICATE statement in its simplest form has the following
format:

CREATE CERTIFICATE ATestCertificate WITH SUBJECT = 'A Test Certificate';

If that doesn’t work, make sure the master key is opened…

USE\<database_name\>;

OPEN MASTER KEY DECRYPTION BY PASSWORD = ‘\*\*\*\*\*’;

GO

CLOSE MASTER KEY;

GO

###### Using Password

\[sql\]

CREATE CERTIFICATE ATestCertificate  
ENCRYPTION BY PASSWORD = '\*\*\*\*\*\*\*\*\*\*'  
WITH SUBJECT = 'A Test Certificate';  
\[/sql\]

*Note: Above we are creating a self-signed certificate (not using
external authority) using a password we provide (instead of the default
– which is a database masterkey).*

ATestCertificate is the name for the certificate. . Subject is a field
defined by the X.509 standard and certificates created by this command
follow that standard. In SQL Server, the subject can be up to 128
characters long. This is a SQL Server restriction, the X.509 standard
itself allows for longer subjects.

The private key for SQL Server generated certificates is always a
1024-bit key for the RSA encryption algorithm. SQL Server supports
imported certificate key lengths from 384 to 4096 bits but can only
generate this one key length for certificates.

##### Create Symmetric Key and handle encryption/decryption

<https://docs.microsoft.com/en-us/sql/t-sql/statements/create-symmetric-key-transact-sql?view=sql-server-ver15>

###### \[Method 1\] Create Symmetric Key (encrypted by certificate)

***Abstract***

CREATE SYMMETRIC KEY \<cool_key_name\>

WITH ALGORITHM = AES_256

ENCRYPTION BY CERTIFICATE \<certificate_name\>;

GO

The following example creates a symmetric key called
**“supersymmetrickey”** by using the AES 256 algorithm, and then
encrypts the new key with certificate named **“ATestCertificate”**
(which was created using a masterkey in this example).

***Concrete Example***

CREATE SYMMETRIC KEY supersymmetrickey

WITH ALGORITHM = AES_256

ENCRYPTION BY CERTIFICATE ATestCertificate;

GO

Verify key exists

SELECT \* FROM sys.symmetric_keys

Keys will be saved, not under databases schema, but under Security \>
Symmetric schema

<img src="./media/image578.png" style="width:2.98958in;height:4.05208in"
alt="A screenshot of a computer Description automatically generated" />

####### Encrypt data (by symmetric key generated from certificate)

***Abstract***

OPEN SYMMETRIC KEY \<symmetric key name\>

DECRYPTION BY CERTIFICATE \<cert that was used to create sym key\>

INSERT INTO \<some table\>

VALUES(

EncryptByKey(key_GUID(‘\<symmetric key name \>'), 'pleaseencryptme' )

)

CLOSE SYMMETRIC KEY \< symmetric key name \>

***Concrete example***

OPEN SYMMETRIC KEY supersymmetrickey

DECRYPTION BY CERTIFICATE ATestCertificate

INSERT INTO key_testing

VALUES(

EncryptByKey(key_GUID('supersymmetrickey'), 'pleaseencryptme' )

)

CLOSE SYMMETRIC KEY supersymmetrickey

####### Decrypt data (by symmetric key generated from certificate)

**Abstract**

OPEN SYMMETRIC KEY \<symmetric_key_name\>

DECRYPTION BY PASSWORD='\<password\>'

SELECT CONVERT(VARCHAR(MAX),DECRYPTBYKEY(encpass))

FROM key_testing WHERE id='5'

CLOSE SYMMETRIC KEY \<symmetric_key_name\>

**Concrete example**

OPEN SYMMETRIC KEY supersymmetrickeywpass

DECRYPTION BY PASSWORD='mycoolpassword'

SELECT CONVERT(VARCHAR(MAX),DECRYPTBYKEY(encpass))

FROM key_testing WHERE id='5'

CLOSE SYMMETRIC KEY supersymmetrickeywpass

###### \[Method\] Create Symmetric key (Encrypted by password)

***Abstract***

CREATE SYMMETRIC KEY \<cool_key_name\>

WITH ALGORITHM = AES_256

ENCRYPTION BY PASSWORD='\<password\>';

***Concrete Example***

The following example creates a symmetric key called
**“supersymmetrickey”** by using the AES 256 algorithm, and then
encrypts the new key with certificate named **“ATestCertificate”**
(which was created using a masterkey in this example).

CREATE SYMMETRIC KEY supersymmetrickeywpass

WITH ALGORITHM = AES_256

ENCRYPTION BY PASSWORD='mycoolpassword';

GO

Verify key exists

SELECT \* FROM sys.symmetric_keys

Keys will be saved, not under databases schema, but under Security \>
Symmetric schema

<img src="./media/image578.png" style="width:2.98958in;height:4.05208in"
alt="A screenshot of a computer Description automatically generated" />

####### Encrypt data (using symmetric key generated by password)

***Abstract***

OPEN SYMMETRIC KEY \<symmetric_key_name\>

DECRYPTION BY PASSWORD='mycoolpassword'

INSERT INTO key_testing

VALUES(

EncryptByKey(key_GUID(\<symmetric_key_name\>), 'pleaseencryptmemoar' )

)

CLOSE SYMMETRIC KEY supersymmetrickeywpass

***Concrete Example***

OPEN SYMMETRIC KEY supersymmetrickeywpass

DECRYPTION BY PASSWORD='mycoolpassword'

INSERT INTO key_testing

VALUES(

EncryptByKey(key_GUID('supersymmetrickeywpass'), 'pleaseencryptmemoar' )

)

CLOSE SYMMETRIC KEY supersymmetrickeywpass

####### Decrypt data (using symmetric key generated by password)

-- 8. Decrypt an encrypted string (using varchar max but if you have an
initial string length pre-defined on the plaintext to be encrypted that
you can use the minimum - for example char(9))

OPEN SYMMETRIC KEY PWHist

DECRYPTION BY
PASSWORD='r4pkkdSCGdWdEV4F3SHFrBTygZr6DJKX8Zre4RYaUyAuYqPuTFayquVVRDcT7PVB'

SELECT CONVERT(VARCHAR(MAX),DECRYPTBYKEY(encpass))

FROM key_testing WHERE id='1'

CLOSE SYMMETRIC KEY PWHist

##### …

### Move table from one Schema to another

<table>
<colgroup>
<col style="width: 4%" />
<col style="width: 95%" />
</colgroup>
<thead>
<tr>
<th><p>1</p>
<p>2</p></th>
<th><p>ALTER SCHEMA NewSchema</p>
<p>TRANSFER OldSchema.TableName;</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>

### Adding a user/login

<img src="./media/image579.png" style="width:6.5in;height:2.44306in"
alt="A screenshot of a computer Description automatically generated" />

<img src="./media/image580.png" style="width:6.5in;height:4.21667in" />

### Change password

<img src="./media/image581.png" style="width:6.5in;height:1.09514in"
alt="A screenshot of a computer Description automatically generated" />

Another way:  
<img src="./media/image582.png" style="width:6.5in;height:5.19028in" />

### Delete a user

<img src="./media/image583.png" style="width:6.5in;height:1.25625in"
alt="A screenshot of a computer Description automatically generated" />

### Getting db info

<https://chartio.com/resources/tutorials/sql-server-list-tables-how-to-show-all-tables/>

See all tables of a db

SELECT \* FROM sscore.INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE='BASE
TABLE';

### Backup Your Database

<img src="./media/image584.png" style="width:5.51119in;height:1.8961in"
alt="A screenshot of a computer Description automatically generated" />

<img src="./media/image585.png" style="width:6.5in;height:4.88264in"
alt="A screenshot of a computer Description automatically generated" />

Note: Be sure to include file extention

### Restoring Database

<img src="./media/image586.png" style="width:6.5in;height:5.06389in" />

<img src="./media/image587.png" style="width:6.5in;height:1.60625in"
alt="A screenshot of a computer Description automatically generated" />

### OFFSET/FETCH

SQL Server grab rows start from certain record count to a specified
length of records

<https://www.geeksforgeeks.org/sql-offset-fetch-clause/>

SQL Server:
<https://www.sqlservertutorial.net/sql-server-basics/sql-server-offset-fetch/>

MySQL: <https://www.educba.com/mysql-fetch/>

ORDER BY column_list \[ASC |DESC\]

OFFSET offset_row_count 25

FETCH {FIRST | NEXT} fetch_row_count 100 ONLY

<img src="./media/image588.png" style="width:3.56944in;height:4.45347in"
alt="SQL Server OFFSET FETCH" />

### ROWCOUNT

<https://docs.microsoft.com/en-us/sql/t-sql/functions/rowcount-transact-sql?view=sql-server-ver15>

<https://www.mssqltips.com/sqlservertip/6091/how-to-use-rowcount-in-sql-server/>

<https://database.guide/rowcount-get-the-number-of-rows-affected-by-the-last-statement-in-sql-server/>

<img src="./media/image589.png" style="width:4.21934in;height:1.68774in"
alt="A screenshot of a computer Description automatically generated" />

<img src="./media/image590.png" style="width:4.90694in;height:2.84415in"
alt="A screenshot of a computer program Description automatically generated" />

The T-SQL language provides us with
the [@@ROWCOUNT](https://docs.microsoft.com/en-us/sql/t-sql/functions/rowcount-transact-sql?view=sql-server-2017) system
variable. This variable returns the number of rows affected by the last
executed statement in the batch. In this tip, we’ll demonstrate how to
use this variable and point out some caveats.

**Using SQL Server @@ROWCOUNT**

The usage of the variable is straight forward. You simply select if
after the statement you wish to check as shown below:

<img src="./media/image591.png" style="width:6.71875in;height:5.48958in"
alt="@@rowcount simple example" />

The statement can be anything that affects rows: SELECT, INSERT, UPDATE,
DELETE and so on. It’s important that @@ROWCOUNT is called in the same
execution as the previous query.

Suppose I would run the SELECT statement first from the previous
example, and then run SELECT @@ROWCOUNT separately.  This will return 1
instead of 1,000 as shown below:

<img src="./media/image592.png" style="width:4.83333in;height:3.875in"
alt="@@rowcount not in same batch" />

This is because executing SELECT @@ROWCOUNT by itself returns 1. If you
open a new query window (and thus a new session) and you fetch
@@ROWCOUNT, the value of 1 will be returned:

<img src="./media/image593.png" style="width:2.80208in;height:1.8125in"
alt="@@rowcount alone" />

**Using SQL Server @@ROWCOUNT for Error Handling and Checking a Business
Rule**

Typically, @@ROWCOUNT is used for error handling or for checking a
business rule. You can access @@ROWCOUNT like any other variable in an
IF statement. For example:

<img src="./media/image594.png" style="width:5.41667in;height:3.4375in"
alt="checking logic with @@ROWCOUNT" />

In this script, we perform an UPDATE statement. After the statement is
done, we check if any rows were updated at all. If not, a message will
be printed. In reality, you can take other actions such as throwing an
error message
with [RAISERROR](https://www.mssqltips.com/sqlservertip/1660/using-the-nowait-option-with-the-sql-server-raiserror-statement/),
send an e-mail or kick of some stored procedure. The transaction is used
in the example to roll back the update, so we don’t mess with our sample
database.

Here’s the script if you want to run it yourself:

BEGIN TRAN

UPDATE \[Sales\].\[SalesOrderHeader\]

SET \[SubTotal\] = \[SubTotal\] \* 1.1; -- 10% increase

IF @@ROWCOUNT = 0

PRINT 'Something went wrong!'

ELSE PRINT 'Rows were updated...'

--COMMIT

ROLLBACK

### COPY A TABLE 1-STEP \[MySQL\]

<img src="./media/image595.png" style="width:6.5in;height:3.36736in"
alt="Graphical user interface, application Description automatically generated" />

### COPY A TABLE \[SQL SERVER\]

One liner…

SELECT \* INTO source_table_copy FROM source_table;

At least SQL Server – haven’t tried in MySQL

- COPY TABLE SQL SERVER (table structure)

  - SELECT top 0 \* INTO source_table_copy FROM source_table;

- COPY DATA INTO NEW TABLE

  - INSERT INTO target_table SELECT \* FROM source_table;

One can also, copy table structure in SQL server by right clicking on a
table and using “script table as…

### TCL (transaction-based sql)

<img src="./media/image596.png" style="width:6.5in;height:3.38194in"
alt="Text Description automatically generated with medium confidence" /><img src="./media/image597.png" style="width:6.5in;height:2.07569in"
alt="Diagram Description automatically generated" />

<img src="./media/image598.png" style="width:6.5in;height:2.03611in"
alt="Graphical user interface, text, email Description automatically generated" />

## Variables

### Local Variables

Local Variables are declared using the **DECLARE** keyword.

<img src="./media/image599.png" style="width:6.5in;height:2.80139in"
alt="A picture containing diagram Description automatically generated" /><img src="./media/image600.png" style="width:6.5in;height:3.22153in"
alt="Diagram Description automatically generated" /><img src="./media/image601.png" style="width:6.5in;height:3.03542in"
alt="Graphical user interface, text, application, chat or text message Description automatically generated" />

### Session Variables

<img src="./media/image602.png" style="width:6.5in;height:1.98889in"
alt="Graphical user interface, text Description automatically generated" /><img src="./media/image603.png" style="width:6.5in;height:3.17361in"
alt="Timeline Description automatically generated" />

<img src="./media/image604.png" style="width:6.5in;height:1.83819in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image605.png" style="width:6.36722in;height:2.24186in"
alt="Graphical user interface, text, application Description automatically generated" />

### Global Variables

<img src="./media/image606.png" style="width:6.5in;height:1.15972in"
alt="Graphical user interface, application Description automatically generated" />

Global variables can de defined in two ways:

<img src="./media/image607.png" style="width:6.00885in;height:3.80866in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image608.png" style="width:6.5in;height:0.93611in"
alt="Text Description automatically generated" />

### User-defined variables vs System variables

<img src="./media/image609.png" style="width:6.5in;height:2.45903in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image610.png" style="width:6.5in;height:3.34792in"
alt="A picture containing calendar Description automatically generated" />
<img src="./media/image611.png" style="width:6.5in;height:2.82222in"
alt="Graphical user interface, text, application, chat or text message Description automatically generated" />

## Stored Routines

<img src="./media/image612.png" style="width:6.5in;height:2.04861in"
alt="Timeline Description automatically generated" />
<img src="./media/image613.png" style="width:6.5in;height:3.34028in"
alt="Diagram Description automatically generated" />
<img src="./media/image614.png" style="width:6.5in;height:3.925in"
alt="Timeline Description automatically generated" />

### Stored procedures

<img src="./media/image615.png" style="width:6.5in;height:1.91528in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image616.png" style="width:6.5in;height:1.76736in"
alt="Text Description automatically generated" />

**Note**: The **BEGIN** and **END** keywords store the
routine/procedure/function itself.

<img src="./media/image617.png" style="width:6.08386in;height:3.1336in"
alt="Text Description automatically generated" />
<img src="./media/image618.png" style="width:5.7505in;height:2.99193in"
alt="Diagram, text Description automatically generated" />
<img src="./media/image619.png" style="width:4.92543in;height:2.59189in"
alt="Graphical user interface, text, application, email Description automatically generated" />
<img src="./media/image620.png" style="width:6.02552in;height:3.30029in"
alt="Graphical user interface, text, application Description automatically generated" />

#### Creating a procedure (Non-parametric)

**How to drop a procedure**
<img src="./media/image621.png" style="width:6.5in;height:0.70764in" />

<img src="./media/image622.png" style="width:4.14203in;height:2.91692in"
alt="Text Description automatically generated" />

You can verify that your stored procedure exists by refreshing and
checking your schema section in MySQL workbench.

<img src="./media/image623.png" style="width:2.15852in;height:1.55847in"
alt="Graphical user interface, text, application Description automatically generated" />

#### Invoking a procedure

**Method 1 (Preferred)**

<img src="./media/image624.png" style="width:6.5in;height:0.72292in" />

**Method 2**

If you are already using a database you don’t need to specify the
database using the dot notation.
<img src="./media/image625.png" style="width:2.25853in;height:0.45837in"
alt="Text Description automatically generated with medium confidence" />

**Method 3**

<img src="./media/image626.png" style="width:2.39187in;height:0.79174in"
alt="Graphical user interface, application, Word Description automatically generated" />

#### Creating a procedure (Parametric)

##### Input parameter

<img src="./media/image627.png" style="width:6.5in;height:2.03472in"
alt="Text Description automatically generated with medium confidence" />
<img src="./media/image628.png" style="width:6.5in;height:1.89028in"
alt="Graphical user interface, text, application Description automatically generated with medium confidence" />
<img src="./media/image629.png" style="width:2.97526in;height:1.00842in"
alt="Graphical user interface Description automatically generated with low confidence" />

<img src="./media/image630.png" style="width:6.5in;height:3.99931in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image631.png" style="width:5.03377in;height:1.75015in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image632.png" style="width:4.17536in;height:4.21703in"
alt="Graphical user interface, text Description automatically generated" />

##### Input + Output parameter

<img src="./media/image633.png" style="width:6.5in;height:2.34306in"
alt="Graphical user interface, text Description automatically generated" />
<img src="./media/image634.png" style="width:6.5in;height:2.25972in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image635.png" style="width:6.5in;height:2.96667in"
alt="Graphical user interface, application Description automatically generated" /><img src="./media/image636.png" style="width:6.5in;height:2.26042in"
alt="Graphical user interface Description automatically generated" /><img src="./media/image637.png" style="width:6.5in;height:2.56181in"
alt="Graphical user interface, text, application Description automatically generated" />

#### Variables

<img src="./media/image638.png" style="width:6.5in;height:1.92847in"
alt="Timeline Description automatically generated" />

1)  Set varible

2)  Call procedure

3)  Query vairable to confirm results

<img src="./media/image639.png" style="width:5.49214in;height:1.06676in"
alt="Graphical user interface, application, Word Description automatically generated" />

### User defined Functions

<img src="./media/image640.png" style="width:6.5in;height:2.35556in"
alt="Graphical user interface, text Description automatically generated" />
<img src="./media/image641.png" style="width:6.5in;height:2.32014in"
alt="Graphical user interface Description automatically generated with low confidence" />
<img src="./media/image642.png" style="width:6.36722in;height:0.96675in"
alt="Text Description automatically generated with medium confidence" />

Full…<img src="./media/image643.png" style="width:6.43389in;height:3.29195in"
alt="Graphical user interface, text, application, email Description automatically generated" />

#### Troubleshooting: Error 1418

Simply add ONE of these keywords…

Try one at a time

<img src="./media/image644.png" style="width:6.5in;height:2.53542in"
alt="Graphical user interface, text, application Description automatically generated" />

Full details on this error…

Error Code: 1418.

**Error Code: 1418. This function has none of DETERMINISTIC, NO SQL, or
READS SQL DATA in its declaration and binary logging is enabled…**

Let’s begin by saying that a *log* is a software component where you can
save information about some events or errors that happened during the
execution of a certain application. A log is preserved for traceability
or debugging reasons and this is how it is used in MySQL as well.

Consequently, a *Binary* Log is a log that contains database changes.
This type of logging affects the way in which we need to structure our
code when creating MySQL functions.

**When the Binary Log has been enabled**, it will always check whether a
function is changing the data in the database and what is the result to
be produced. The situation can be described like this.

Unless we specify what the exact behavior of our function should be, our
code will lead to an error. This error is with code 1418 and states that
the function has none of the following characteristics in its
declaration: DETERMINISTIC, NO SQL, or READS SQL DATA.

To solve this error, we must include one (or more) of these
characteristics in our code in the way shown in the previous video. They
must be placed right after we ‘ve specified the return type of the
function. Here’s the syntax to use:

**create function \<function name\> \<function parameters\> returns
\<type\> \<characteristics\> …**

Let’s check the meaning of these characteristics:

· DETERMINISTIC – it states that the function will always return
identical result given the same input

· NO SQL – means that the code in our function does not contain SQL
(rarely the case)

· READS SQL DATA – this is usually when a simple SELECT statement is
present

When none of those is present in our code, MySQL assumes that our
function is non deterministic and that it changes data. This might not
be the case, but still, in the end, an error is raised just because
MySQL cannot know a priori what our function will do. Adding one of
those to our code will prevent this error of showing up.

That said, there is another way to stop the error - by *disabling* the
binary log when creating functions. And we can achieve this by executing
the following command:

SET @@global.log_bin_trust_function_creators := 1;

Technically speaking, this operation isn’t the safest one out there.
Nevertheless, for the purposes of this course, it is the one that will
solve the potential problems regardless of the version of MySQL.

In conclusion, remember that sometimes the Binary Log may be disabled
anyway and you don’t have to take any of the above actions. In that
case, we simply hope you’ve enjoyed reading this article! Thank you!

#### Calling a user-defined function

User-defined functions are called – but queried using **SELECT**

<img src="./media/image645.png"
style="width:3.16694in;height:0.35836in" />

### Stored Procedures vs User defined functions

<img src="./media/image646.png" style="width:6.5in;height:3.81736in"
alt="Calendar Description automatically generated" />
<img src="./media/image647.png" style="width:6.5in;height:3.39444in"
alt="Calendar Description automatically generated" />
<img src="./media/image648.png" style="width:6.5in;height:3.24306in"
alt="Calendar Description automatically generated" />
<img src="./media/image649.png" style="width:6.5in;height:3.83333in"
alt="A picture containing diagram Description automatically generated" />

## Database Triggers

<img src="./media/image650.png" style="width:6.5in;height:2.54167in"
alt="Text Description automatically generated with medium confidence" />
<img src="./media/image651.png" style="width:6.5in;height:2.11042in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image652.png" style="width:6.5in;height:2.78472in"
alt="Text Description automatically generated with low confidence" />

Then, an interesting phrase follows – “for each row”. It designates that
before the trigger is activated, MySQL will perform a check for a change
of the state of the data on all rows.

#### Example – Before Insert:

<img src="./media/image653.png" style="width:3.20861in;height:1.86683in"
alt="Graphical user interface, text Description automatically generated" />

**First**, especially for those of you who are familiar with some
programming, this is an example of a conditional. The IF statement
starts the conditional block. Then, if the condition for negative salary
is satisfied, one must use the keyword **THEN** before showing what
action should follow. The operation is terminated by the **END IF**
phrase and a semi-colon.

The **second** thing to be noted here is even more interesting. That’s
the use of the keyword **NEW**. In general, it refers to a row that has
just been inserted or updated. In our case, after we insert a new
record, “**NEW** dot salary” will refer to the value that will be
inserted in the “Salary” column of the “Salaries” table.

The **third** part of the syntax regards the **SET** keyword. As you
already know, it is used whenever a value has to be assigned to a
certain variable. Here, the variable is the newly inserted salary, and
the value to be assigned is 0.

#### Example – Before Update:

<img src="./media/image654.png" style="width:3.14194in;height:1.91683in"
alt="Text Description automatically generated" />

<img src="./media/image655.png" style="width:6.5in;height:1.48542in"
alt="Graphical user interface, text, application Description automatically generated" />

### SQL Server syntax

<https://www.sqlshack.com/learn-sql-sql-triggers/>

The trigger time and event are after the **ON** keyword.

<img src="./media/image656.png" style="width:6.37555in;height:2.83358in"
alt="Graphical user interface, text, application, email Description automatically generated" />

<img src="./media/image657.png" style="width:5.19212in;height:1.05843in"
alt="Graphical user interface, text, application Description automatically generated with medium confidence" />

**Popular use cases for triggers:**

1)  Validating data before inserting

2)  Updating some other table based on some action in current table

### Example 1

<img src="./media/image658.png" style="width:6.5in;height:3.64722in"
alt="Text Description automatically generated" />
<img src="./media/image659.png" style="width:6.5in;height:3.68611in"
alt="Timeline Description automatically generated" />

There are three different components to a MySQL error. **SQLSTATE** is
one if them

<img src="./media/image660.png" style="width:6.5in;height:2.32153in"
alt="Text Description automatically generated" />

<img src="./media/image661.png" style="width:6.5in;height:3.34375in"
alt="Timeline Description automatically generated" />

**4500** is the SQL state code we can use to let MySQL know that we (the
developer) are throwing the error manually ourselves.

<img src="./media/image662.png" style="width:6.5in;height:4.2125in"
alt="Timeline Description automatically generated" />

The **SET MESSAGE_TEXT** keyword holds the value to return is an error
is thrown *(above)*.

**Delimiters**

<img src="./media/image663.png" style="width:6.5in;height:3.39861in"
alt="Timeline Description automatically generated" />

Delimiters tell our program where our statement ends. In MySQL the
default delimiter is a semi-colon (**;**). Since semi-colons are used on
triggers (for example, with our **IF/THEN** statement and our
**BEGIN/END** statement), we need to change our delimiter temporarily so
the semi-colons used on out trigger won’t end our entire statement. We
can use the DELIMITER keyword to change the delimiter to any *double*
character we want (in this case **$$**) then we can change it back to
the semi-colon once our trigger is
done.<img src="./media/image664.png" style="width:6.5in;height:1.81875in"
alt="Timeline Description automatically generated" />

### Example 2

<img src="./media/image665.png" style="width:6.5in;height:3.88056in"
alt="Graphical user interface, application Description automatically generated" />

Solution

<img src="./media/image666.png" style="width:6.5in;height:2.33194in"
alt="Graphical user interface, text, application Description automatically generated" />

### Example 3

To log unfollows, create a new table of ‘unfollows’. Each time an
unfollow occurs a new reocrds should be inserted into this table.

<img src="./media/image667.png" style="width:6.5in;height:3.81806in"
alt="Graphical user interface, application, website Description automatically generated" />

**Possible solution**

Note: When we use the **AFTER** keyword for the trigger time we can
access the **OLD** keyword instead of the **NEW** keyword to refer to
the values being manipulated.

<img src="./media/image668.png" style="width:5.91718in;height:2.31687in"
alt="Graphical user interface, text, application Description automatically generated" />

**Alternate solution**

<img src="./media/image669.png" style="width:6.5in;height:3.64167in"
alt="Graphical user interface, text Description automatically generated" />

### Managing triggers

<img src="./media/image670.png" style="width:5.20878in;height:1.83349in"
alt="Graphical user interface, text Description automatically generated" />
<img src="./media/image671.png" style="width:6.5in;height:1.81458in"
alt="Graphical user interface, text, application Description automatically generated" />

## **Secondary, Temporary, Virtual tables, and Views**

### **Working with temporary tables**

**Temporary tables** are exactly what they sound like—temporary tables
in a SQL database that aren’t stored permanently. In this reading, you
will learn the methods to create temporary tables using SQL commands.
You will also learn a few best practices to follow when working with
temporary tables. 

#### A quick refresher on what you have already learned about temporary tables

- They are automatically deleted from the database when you end your SQL
  session.

- They can be used as a holding area for storing values if you are
  making a series of calculations. This is sometimes referred to as
  **pre-processing** of the data.

- They can collect the results of multiple, separate queries. This is
  sometimes referred to as data **staging**. Staging is useful if you
  need to perform a query on the collected data or merge the collected
  data.

- They can store a filtered subset of the database. You don’t need to
  select and filter the data each time you work with it. In addition,
  using fewer SQL commands helps to keep your data clean.

It is important to point out that each database has its own unique set
of commands to create and manage temporary tables. We have been working
with BigQuery, so we will focus on the commands that work well in that
environment. The rest of this reading will go over the ways to create
temporary tables, primarily in BigQuery.

<img src="./media/image672.png" style="width:6.5in;height:2.59097in"
alt="An image of 3 data tables. The table in the middle is faded surrounded by dotted lines" />

#### Temporary table creation in BigQuery

Temporary tables can be created using different clauses. In BigQuery,
the **WITH** clause can be used to create a temporary table. The general
syntax for this method is as follows:

<img src="./media/image673.png" style="width:4.89514in;height:4.53472in"
alt="WITH new_table_data AS ( SELECT * FROM Existing_table WHERE Tripduration &gt;=60 )" />

Breaking down this query a bit, notice the following:

- The statement begins with the **WITH** clause followed by the name of
  the new temporary table you want to create

- The **AS** clause appears after the name of the new table. This clause
  instructs the database to put all of the data identified in the next
  part of the statement into the new table. 

- The opening parenthesis after the **AS** clause creates the subquery
  that filters the data from an existing table. The subquery is a
  regular **SELECT** statement along with a **WHERE** clause to specify
  the data to be filtered. 

- The closing parenthesis ends the subquery created by the **AS**
  clause.

When the database executes this query, it will first complete the
subquery and assign the values that result from that subquery to
“new_table_data,” which is the temporary table. You can then run
multiple queries on this filtered data without having to filter the data
every time. 

#### Temporary table creation in other databases (not supported in BigQuery)

The following method isn’t supported in BigQuery, but most other
versions of SQL databases support it, including SQL Server and mySQL.
Using **SELECT** and **INTO**, you can create a temporary table based on
conditions defined by a **WHERE** clause to locate the information you
need for the temporary table. The general syntax for this method is as
follows:

<img src="./media/image674.png" style="width:5.36042in;height:3.81389in"
alt="Screenshot of SQL query" />SELECT \* INTO AfricaSales FROM
GlobalSales WHERE Region = "Africa"

This **SELECT** statement uses the standard clauses like **FROM** and
**WHERE**, but the **INTO** clause tells the database to store the data
that is being requested in a new temporary table named, in this case,
“AfricaSales.” 

#### User-managed temporary table creation 

So far, we have explored ways of creating temporary tables that the
database is responsible for managing. But, you can also create temporary
tables that you can manage as a user. As an analyst, you might decide to
create a temporary table for your analysis that you can manage yourself.
You would use the **CREATE TABLE** statement to create this kind of
temporary table. After you have finished working with the table, you
would then delete or drop it from the database at the end of your
session.

**Note:** BigQuery uses **CREATE TEMP TABLE** instead of **CREATE
TABLE**, but the general syntax is the same.

<img src="./media/image675.png" style="width:6.08125in;height:3.04653in"
alt="Screenshot of query" />CREATE TABLE table_name ( column1 datatype,
column2 datatype, column3 datatype, .... )

After you have completed working with your temporary table, you can
remove the table from the database using the **DROP TABLE** clause. The
general syntax is as follows:

<img src="./media/image676.png" style="width:5.97708in;height:0.91875in"
alt="Screenshot of query. DROP TABLE table_name" />

#### Best practices when working with temporary tables

- **Global vs. local temporary tables:** Global temporary tables are
  made available to all database users and are deleted when all
  connections that use them have closed. Local temporary tables are made
  available only to the user whose query or connection established the
  temporary table. You will most likely be working with local temporary
  tables. If you have created a local temporary table and are the only
  person using it, you can drop the temporary table after you are done
  using it.

<!-- -->

- **Dropping temporary tables after use:** Dropping a temporary table is
  a little different from deleting a temporary table. Dropping a
  temporary table not only removes the information contained in the rows
  of the table, but removes the table variable definitions (columns)
  themselves. Deleting a temporary table removes the rows of the table
  but leaves the table definition and columns ready to be used again.
  Although local temporary tables are dropped after you end your SQL
  session, it may not happen immediately. If a lot of processing is
  happening in the database, dropping your temporary tables after using
  them is a good practice to keep the database running smoothly. 

#### For more information

- [BigQuery Documentation for Temporary
  Tables](https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language#temporary_tables)**:**
  Documentation has the syntax to create temporary tables in BigQuery

- [How to use temporary tables via WITH in Google
  BigQuery](https://www.pascallandau.com/bigquery-snippets/use-temporary-tables-with-named-subquery/?utm_source=blog&utm_medium=rss&utm_campaign=development-feed)**:**
  Article describes how to use **WITH** 

- [Introduction to Temporary Tables in SQL
  Server](https://codingsight.com/introduction-to-temporary-tables-in-sql-server/)**:**
  Article describes how to use **SELECT INTO** and **CREATE TABLE** 

- [SQL Server Temporary
  Tables](https://www.sqlservertutorial.net/sql-server-basics/sql-server-temporary-tables/)**:**
  Article describes temporary table creation and removal

- [Choosing Between Table Variables and Temporary
  Tables](https://www.red-gate.com/hub/product-learning/sql-prompt/choosing-table-variables-temporary-tables)**:**
  Article describes the differences between passing variables in SQL
  statements vs. using temporary tables

### Temporary tables \[SQL Server\]

<https://www.youtube.com/watch?v=oGuS1rdfaMI>

====

<img src="./media/image677.png" style="width:6.5in;height:4.15764in"
alt="Graphical user interface, text Description automatically generated with medium confidence" />

<img src="./media/image678.png" style="width:6.5in;height:4.47986in"
alt="Graphical user interface, application Description automatically generated" />

<img src="./media/image679.png" style="width:6.5in;height:2.78472in"
alt="Graphical user interface, text, website Description automatically generated with medium confidence" />

<img src="./media/image680.png" style="width:6.5in;height:3.20069in"
alt="Graphical user interface, text, application, email Description automatically generated" />

### WITH command (CTE) \[MySQL + SQL Server\]

<https://www.youtube.com/watch?v=ZXB5b-7HJHk>

<img src="./media/image681.png" style="width:6.5in;height:4.50417in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image682.png" style="width:6.5in;height:3.72778in"
alt="Graphical user interface, text, application, email Description automatically generated" />

<img src="./media/image683.png" style="width:6.5in;height:4.27153in"
alt="Graphical user interface, text Description automatically generated" />

### Views

*Virtual tables*

<img src="./media/image684.png" style="width:6.5in;height:1.73681in"
alt="Graphical user interface, text, application Description automatically generated" />
<img src="./media/image685.png" style="width:6.5in;height:1.38264in"
alt="Website Description automatically generated with low confidence" />
<img src="./media/image686.png" style="width:6.5in;height:1.59722in"
alt="Text Description automatically generated with medium confidence" />

#### Creating

<img src="./media/image687.png" style="width:5.62549in;height:1.52513in"
alt="A picture containing text Description automatically generated" />

**View**: Essentials saves a **SELECT** query using an alias. Simply run
a regular **SELECT** query and prefix it with a **‘CREATE VIEW
\<view-name\> AS \<query\>**’. Views can be accessed as regular tables
can.

<img src="./media/image688.png" style="width:6.5in;height:3.13958in"
alt="A screenshot of a computer program Description automatically generated" />

It’s good practive to start a view name with a ‘**v**’.

<img src="./media/image689.png" style="width:6.5in;height:1.99167in"
alt="Table Description automatically generated" />

<img src="./media/image689.png" style="width:6.5in;height:1.99167in"
alt="Table Description automatically generated" />

If you run SHOW TABLES you’ll see the table listed.

<img src="./media/image690.png" style="width:6.5in;height:3.57917in"
alt="Text Description automatically generated" />

**CREATE OR REPLACE** will replace any already existing view with the
same name. Useful for editing existing views

<img src="./media/image691.png" style="width:2.6419in;height:1.85016in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image692.png" style="width:4.10036in;height:0.60005in"
alt="A picture containing graphical user interface Description automatically generated" />

#### Updating/Deleting entries in a view

Views can be updated/deleted – with the exception of views that include
the following…

<img src="./media/image693.png" style="width:3.75866in;height:1.45846in"
alt="Graphical user interface Description automatically generated with medium confidence" />

**Note**: It’s important to note that views are live and contingent on
their constituents. As such, any changes made to the base tables will
directly affect the view itself.

#### Replace/Alter Views

Re-create a view

<img src="./media/image694.png" style="width:6.5in;height:0.81042in"
alt="A close-up of a sign Description automatically generated" />

Alter a view

<img src="./media/image695.png" style="width:6.5in;height:0.71319in" />

#### Deleting a view

<img src="./media/image696.png"
style="width:5.06711in;height:0.3667in" />

## Processes and Status checks

**SHOW PROCESSLIST** -
<https://www.mysqltutorial.org/mysql-show-processlist/>

so you can see when long running processes are finished:

SELECT \* FROM INFORMATION_SCHEMA.PROCESSLIST ORDER BY Time DESC

**KILL** -
<https://docs.microsoft.com/en-us/sql/t-sql/language-elements/kill-transact-sql?view=sql-server-ver15>

**OPTMIZE TABLE:**
<https://dev.mysql.com/doc/refman/8.0/en/optimize-table.html>

**DBCC CHECKDB:**
<https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql?view=sql-server-ver15>

**EXPLAIN -** <https://www.educba.com/explain-in-sql/>

- Explain is used to show what indexes a query will use once ran. Just
  prefix your query with explain.  
  **EXPLAIN \<query\>**

<img src="./media/image697.png" style="width:6.5in;height:0.42361in" />

## Collation types

Common: COLLATE SQL_Latin1_General_CP1_CI_AS

<img src="./media/image698.png" style="width:6.5in;height:2.80833in"
alt="Graphical user interface, text, application, email Description automatically generated" />

<https://stackoverflow.com/questions/5039211/what-does-collate-sql-latin1-general-cp1-ci-as-do>

## Hashing

### MD5

In MySQL you can just use the ‘MD5()’ function to hash a string you pass
inside.

**MD5 -**
<https://www.w3resource.com/mysql/encryption-and-compression-functions/md5().php>

In SQL Server you use the **HashBytes** function and pass in the hashing
algorithm and the plain text to hash:

<img src="./media/image699.png"
style="width:5.47993in;height:0.44798in" />

Using base 2 to convert it to varchar

SELECT CONVERT(VARCHAR(32), HashBytes('MD5', 'supersecret'), 2);

^ That converts it to the same format used for MySQL and linux md5sum

## Window Functions (MySql)

<img src="./media/image700.png" style="width:6.5in;height:2.33819in" />

### OVER (PARTITION BY)

<img src="./media/image701.png" style="width:6.5in;height:4.64236in"
alt="A screenshot of a computer Description automatically generated" />

What window functions allow us to do is look at aggregate information
alongside individual entries that the aggregate information was based
upon. It’s like a GROUP BY without collapsing all of our results into
single aggregate values.

<img src="./media/image702.png" style="width:6.5in;height:3.37292in" />

<img src="./media/image703.png" style="width:6.5in;height:3.16042in"
alt="A screen shot of a computer Description automatically generated" />

<img src="./media/image704.png" style="width:6.5in;height:1.64792in"
alt="A close-up of a computer screen Description automatically generated" />

<img src="./media/image705.png" style="width:6.5in;height:4.24375in"
alt="A screenshot of a computer screen Description automatically generated" />

### OVER (ORDER BY)

<img src="./media/image706.png" style="width:6.5in;height:2.83125in"
alt="A black and green text Description automatically generated with medium confidence" />

<img src="./media/image707.png" style="width:6.5in;height:1.15764in"
alt="A close-up of a computer screen Description automatically generated" />

^ acts as a rolling sum for each row returned (note how it increments
per row below).

<img src="./media/image708.png" style="width:6.5in;height:3.91736in"
alt="A screenshot of a computer Description automatically generated" />

### RANK

Returns the rank of each row within its current partition.

<img src="./media/image709.png" style="width:6.5in;height:1.40972in" />

^ adding the over functions tells MySQL what column to rank (salary)

<img src="./media/image710.png" style="width:6.5in;height:5.45208in"
alt="A screenshot of a table Description automatically generated" />

Partition by dept

<img src="./media/image711.png" style="width:6.5in;height:1.27292in"
alt="A close-up of a computer code Description automatically generated" />

<img src="./media/image712.png" style="width:6.5in;height:4.1in"
alt="A screenshot of a table Description automatically generated" />

### DENSE_RANK and ROW_NUMBER()

<img src="./media/image713.png" style="width:6.5in;height:1.43056in"
alt="A close-up of a computer screen Description automatically generated" />

With rank alone, entries of the same rank will have the same rank value,
but the next rank value is skipped. Adding ROW_NUMBER allows us to see
maintain the rank value.

<img src="./media/image714.png" style="width:6.5in;height:3.13819in"
alt="A table of numbers with text Description automatically generated" />

DENSE_ROW

Better – this way rank values aren’t skipped.

<img src="./media/image715.png" style="width:6.5in;height:0.55556in" />

<img src="./media/image716.png" style="width:6.5in;height:1.64653in"
alt="A screenshot of a computer screen Description automatically generated" />

<img src="./media/image717.png" style="width:6.5in;height:2.91736in"
alt="A table of numbers with a number on it Description automatically generated with medium confidence" />

### LEAD and LAG

Useful for comparisons between adjacent rows (lag for next row and lead
for previous row).

<img src="./media/image718.png" style="width:6.5in;height:4.82153in"
alt="A screenshot of a computer Description automatically generated" />

^ note how lag just returns previous row’s value.

This is useful when running expressions against the next/previous row

<img src="./media/image719.png" style="width:6.5in;height:1.35in"
alt="A close-up of a sign Description automatically generated" />

<img src="./media/image720.png" style="width:4.68084in;height:4.24976in"
alt="A table of numbers and lines Description automatically generated with medium confidence" />

Could even specify how may rows you want to lead/lag by. The default is
1, but we can set any value – see we’re setting 2 here to check 2 rows
back

<img src="./media/image721.png" style="width:6.5in;height:4.03472in"
alt="A screenshot of a computer Description automatically generated" />

### FIRST_TILE

<img src="./media/image722.png" style="width:5.22464in;height:0.83449in"
alt="A close up of text Description automatically generated" />

<img src="./media/image723.png" style="width:6.5in;height:3.91181in"
alt="A screenshot of a document Description automatically generated" />

### NTILE

<img src="./media/image724.png" style="width:6.5in;height:2.49236in"
alt="A close-up of a white page Description automatically generated" />

<img src="./media/image725.png" style="width:6.5in;height:4.23056in"
alt="A screenshot of a document Description automatically generated" />

## Modes (MySQL)

<img src="./media/image726.png" style="width:6.5in;height:2.425in"
alt="A close-up of a web page Description automatically generated" />

<img src="./media/image727.png" style="width:6.5in;height:2.19861in"
alt="A computer screen shot of a computer program Description automatically generated" />

## INDEX

<img src="./media/image728.png" style="width:6.5in;height:2.65069in"
alt="Text Description automatically generated" />

<img src="./media/image729.png" style="width:6.5in;height:2.89097in"
alt="Graphical user interface, text, application Description automatically generated" />

<https://www.w3schools.com/sql/sql_create_index.asp>

<https://www.youtube.com/watch?v=fsG1XaZEa78>

<https://www.youtube.com/watch?v=yWj320oEQEo>

**INDEX**: Lets SQL know to be extra efficient and to expect the values
passed into be queried very often.

**Best Practice**: Ideal to set indexes on columns that are queried
often using the **WHERE** clause.

Where PRIMARY KEYS serves as a great integer identifier for queries, an
INDEX serves as a great string identifier.

**Note**: Indexes can be
[created](https://www.w3schools.com/sql/sql_create_index.asp) or
declared while creating a table (below).

### Fill factor

<https://www.youtube.com/watch?v=t7EsynHxHDY>

<https://www.youtube.com/watch?v=qXDhMJCuDEc>

<https://learn.microsoft.com/en-us/sql/relational-databases/indexes/index-properties-f1-help?f1url=%3FappId%3DDev15IDEF1%26l%3DEN-US%26k%3Dk(sql13.SWB.INDEXPROPERTIES.OPTIONS.F1)%26rd%3Dtrue&view=sql-server-ver16>

**Fill factor**

Specifies a percentage that indicates how full the Database Engine
should make the leaf level of each index page during index creation or
rebuild. fillfactor must be an integer value from 1 to 100. If
fillfactor is 100, the Database Engine creates indexes with leaf pages
filled to capacity. The FILLFACTOR setting applies only when the index
is created or rebuilt. The Database Engine does not dynamically keep the
specified percentage of empty space in the pages.

**Example**: 90% fill factor is best for a read-heavy table (with
infrequent inserts) while still leaving room for index to grow to reduce
page splits.

### Index Algorithms

<img src="./media/image730.png" style="width:6.5in;height:3.25556in"
alt="Text Description automatically generated" />

<img src="./media/image731.png" style="width:6.5in;height:3.04444in"
alt="Text Description automatically generated" />

<img src="./media/image732.png" style="width:6.5in;height:2.84931in"
alt="Text Description automatically generated" />

<img src="./media/image733.png" style="width:6.5in;height:3.34514in"
alt="Graphical user interface, diagram, application, Teams Description automatically generated" />

<img src="./media/image734.png" style="width:6.5in;height:3.23194in"
alt="Graphical user interface, text Description automatically generated" />

**When to use which**

**A B-tree index** can be used for column comparisons in expressions
that use
the [<u>=</u>](https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_equal), [<u>\></u>](https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_greater-than), [<u>\>=</u>](https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_greater-than-or-equal), [<u>\<</u>](https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_less-than), [<u>\<=</u>](https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_less-than-or-equal),
or [<u>BETWEEN</u>](https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_between) operators.
The index also can be used
for [<u>LIKE</u>](https://dev.mysql.com/doc/refman/8.0/en/string-comparison-functions.html#operator_like) comparisons
if the argument
to [<u>LIKE</u>](https://dev.mysql.com/doc/refman/8.0/en/string-comparison-functions.html#operator_like) is
a constant string that does not start with a wildcard character. For
example, the
following [<u>SELECT</u>](https://dev.mysql.com/doc/refman/8.0/en/select.html) statements
use indexes:

**Hash indexes** are used only for equality comparisons that use
the = or \<=\> operators (but are *very* fast). They are not used for
comparison operators such as \< that find a range of values. Systems
that rely on this type of single-value lookup are known as “key-value
stores”; to use MySQL for such applications, use hash indexes wherever
possible.

**Gist indexes** (postgresql) can be used for indexing fields containing
large values of readable text.

### Creating Indexes

**Table scan**: Describes a linear record-by-record search when
querying.

Indexes gives logarithmic time complexity and are saved in a B-tree
structure by default

<img src="./media/image735.png" style="width:5.91697in;height:1.5348in"
alt="Graphical user interface, text Description automatically generated" />

<img src="./media/image736.png" style="width:6.5in;height:1.04931in"
alt="Graphical user interface Description automatically generated with low confidence" />

<img src="./media/image737.png" style="width:6.5in;height:0.49653in" />

**Index Types**

<img src="./media/image738.png" style="width:6.5in;height:3.30208in"
alt="Text Description automatically generated" />

<img src="./media/image739.png" style="width:6.00052in;height:4.85042in"
alt="Graphical user interface, text, application, Teams Description automatically generated" />

**Best practice for index naming**: IDX_table_column

<img src="./media/image740.png" style="width:6.5in;height:0.80972in"
alt="Graphical user interface, text Description automatically generated" />

**Best practice – adding a sort**

<img src="./media/image741.png" style="width:6.5in;height:2.30417in"
alt="Text, table Description automatically generated" />

**Based on single column**

<img src="./media/image742.png" style="width:6.4839in;height:1.10843in"
alt="Text Description automatically generated with low confidence" />

**Based on multiple columns**

<img src="./media/image743.png" style="width:6.5in;height:0.85347in"
alt="A picture containing chart Description automatically generated" />

**Example**

<img src="./media/image744.png" style="width:4.07535in;height:1.21677in"
alt="Text, letter Description automatically generated" /><img src="./media/image745.png" style="width:3.70865in;height:1.37512in"
alt="Graphical user interface, text Description automatically generated" />

#### Clustered vs non-clustered

<https://www.youtube.com/watch?v=ITcOiLSfVJQ>

<https://www.youtube.com/watch?v=NGslt99VOCw>

<img src="./media/image746.png" style="width:6.5in;height:3.00069in"
alt="Graphical user interface, text, application Description automatically generated" />

Primary keys automatically created a clustered Index. It is for this
reason that when a SELECT query is ran on a table with a primary key
(with a clustered index) the physical arrangement of the table is sorted
by the primary key even if the data entered was not in a sorted order.

#### <img src="./media/image747.png" style="width:6.5in;height:1.32014in"
alt="Text Description automatically generated with low confidence" /> <img src="./media/image748.png" style="width:6.5in;height:0.84097in"
alt="Text Description automatically generated" /> <img src="./media/image749.png" style="width:6.5in;height:3.96042in"
alt="Graphical user interface, text Description automatically generated" />Difference

<img src="./media/image750.png" style="width:6.5in;height:3.00069in"
alt="Graphical user interface, text, application Description automatically generated" />

<img src="./media/image751.png" style="width:6.5in;height:5.18125in"
alt="Diagram Description automatically generated" />
<img src="./media/image752.png" style="width:6.5in;height:6.13194in"
alt="Diagram Description automatically generated" />

<img src="./media/image753.png" style="width:4.80875in;height:4.40872in"
alt="Graphical user interface, application Description automatically generated" />

#### Composite Index

<img src="./media/image754.png" style="width:6.5in;height:2.67153in"
alt="Graphical user interface, text, application, email Description automatically generated" />

#### On performance

<img src="./media/image755.png" style="width:6.5in;height:2.57361in"
alt="Timeline Description automatically generated" />

# Database Engineering

## ACID properties

<https://en.wikipedia.org/wiki/ACID>

<https://www.databricks.com/glossary/acid-transactions>
